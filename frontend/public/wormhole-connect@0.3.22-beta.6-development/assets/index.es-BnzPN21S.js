const __vite__fileDeps=["assets/index-Ci7BRqEw.js","main.js","main.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{ae as Lh,z as gt,d as te,cu as Ao,_ as Ew}from"../main.js";import{c as q,s as xo,x as kh,r as zh,H as Iw,a as Hh,q as Ss}from"./index-BPBp_8Vk.js";import{I as lr,f as ft,t as nt,c as Nu,C as Pw,r as Sw,a as Dr,g as Vh,i as bt,b as $s,G as Ow,E as ze,y as Qe,o as Cs,k as Ts,h as Rw,d as $u,e as Nw,s as $w,j as Cw,l as Do,m as As,n as qo,p as Bt,Y as Tw,q as Aw,u as Cu,v as xw}from"./browser-DhSWYkiw.js";import{o as Tu}from"./browser-ponyfill-DKNtzfi-.js";var se={};Object.defineProperty(se,"__esModule",{value:!0});se.getLocalStorage=se.getLocalStorageOrThrow=se.getCrypto=se.getCryptoOrThrow=se.getLocation=se.getLocationOrThrow=se.getNavigator=se.getNavigatorOrThrow=se.getDocument=se.getDocumentOrThrow=se.getFromWindowOrThrow=se.getFromWindow=void 0;function pr(o){let t;return typeof window<"u"&&typeof window[o]<"u"&&(t=window[o]),t}se.getFromWindow=pr;function Ur(o){const t=pr(o);if(!t)throw new Error(`${o} is not defined in Window`);return t}se.getFromWindowOrThrow=Ur;function Dw(){return Ur("document")}se.getDocumentOrThrow=Dw;function qw(){return pr("document")}se.getDocument=qw;function jw(){return Ur("navigator")}se.getNavigatorOrThrow=jw;function Uw(){return pr("navigator")}se.getNavigator=Uw;function Mw(){return Ur("location")}se.getLocationOrThrow=Mw;function Lw(){return pr("location")}se.getLocation=Lw;function kw(){return Ur("crypto")}se.getCryptoOrThrow=kw;function zw(){return pr("crypto")}se.getCrypto=zw;function Hw(){return Ur("localStorage")}se.getLocalStorageOrThrow=Hw;function Vw(){return pr("localStorage")}se.getLocalStorage=Vw;var jo={};Object.defineProperty(jo,"__esModule",{value:!0});jo.getWindowMetadata=void 0;const Au=se;function Kw(){let o,t;try{o=Au.getDocumentOrThrow(),t=Au.getLocationOrThrow()}catch{return null}function r(){const S=o.getElementsByTagName("link"),R=[];for(let j=0;j<S.length;j++){const A=S[j],K=A.getAttribute("rel");if(K&&K.toLowerCase().indexOf("icon")>-1){const x=A.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let B=t.protocol+"//"+t.host;if(x.indexOf("/")===0)B+=x;else{const pe=t.pathname.split("/");pe.pop();const J=pe.join("/");B+=J+"/"+x}R.push(B)}else if(x.indexOf("//")===0){const B=t.protocol+x;R.push(B)}else R.push(x)}}return R}function s(...S){const R=o.getElementsByTagName("meta");for(let j=0;j<R.length;j++){const A=R[j],K=["itemprop","property","name"].map(x=>A.getAttribute(x)).filter(x=>x?S.includes(x):!1);if(K.length&&K){const x=A.getAttribute("content");if(x)return x}}return""}function a(){let S=s("name","og:site_name","og:title","twitter:title");return S||(S=o.title),S}function u(){return s("description","og:description","twitter:description","keywords")}const l=a(),g=u(),w=t.origin,b=r();return{description:g,url:w,icons:b,name:l}}jo.getWindowMetadata=Kw;function Fw(o,t=[]){const r=[];return Object.keys(o).forEach(s=>{if(t.length&&!t.includes(s))return;const a=o[s];r.push(...a.accounts)}),r}const Ww={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Bw(o,t){const{message:r,code:s}=Ww[o];return{message:r,code:s}}function mo(o,t){return!!Array.isArray(o)}var Mr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wo=function(o,t){return wo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},wo(o,t)};function Gw(o,t){wo(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var _o=function(){return _o=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},_o.apply(this,arguments)};function Qw(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function Jw(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var g=o.length-1;g>=0;g--)(l=o[g])&&(u=(a<3?l(u):a>3?l(t,r,u):l(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function Yw(o,t){return function(r,s){t(r,s,o)}}function Zw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function Xw(o,t,r,s){function a(u){return u instanceof r?u:new r(function(l){l(u)})}return new(r||(r=Promise))(function(u,l){function g(N){try{b(s.next(N))}catch(S){l(S)}}function w(N){try{b(s.throw(N))}catch(S){l(S)}}function b(N){N.done?u(N.value):a(N.value).then(g,w)}b((s=s.apply(o,t||[])).next())})}function e0(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(b){return function(N){return w([b,N])}}function w(b){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=b[0]&2?a.return:b[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,b[1])).done)return u;switch(a=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,a=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=t.call(o,r)}catch(N){b=[6,N],a=0}finally{s=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function t0(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function r0(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function bo(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kh(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],l;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(g){l={error:g}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return u}function i0(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Kh(arguments[t]));return o}function s0(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],l=0,g=u.length;l<g;l++,a++)s[a]=u[l];return s}function bi(o){return this instanceof bi?(this.v=o,this):new bi(o)}function n0(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},l("next"),l("throw"),l("return"),a[Symbol.asyncIterator]=function(){return this},a;function l(R){s[R]&&(a[R]=function(j){return new Promise(function(A,K){u.push([R,j,A,K])>1||g(R,j)})})}function g(R,j){try{w(s[R](j))}catch(A){S(u[0][3],A)}}function w(R){R.value instanceof bi?Promise.resolve(R.value.v).then(b,N):S(u[0][2],R)}function b(R){g("next",R)}function N(R){g("throw",R)}function S(R,j){R(j),u.shift(),u.length&&g(u[0][0],u[0][1])}}function o0(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(l){return(r=!r)?{value:bi(o[a](l)),done:a==="return"}:u?u(l):l}:u}}function a0(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof bo=="function"?bo(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(l){return new Promise(function(g,w){l=o[u](l),a(g,w,l.done,l.value)})}}function a(u,l,g,w){Promise.resolve(w).then(function(b){u({value:b,done:g})},l)}}function c0(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function u0(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function h0(o){return o&&o.__esModule?o:{default:o}}function l0(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function p0(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const d0=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return _o},__asyncDelegator:o0,__asyncGenerator:n0,__asyncValues:a0,__await:bi,__awaiter:Xw,__classPrivateFieldGet:l0,__classPrivateFieldSet:p0,__createBinding:t0,__decorate:Jw,__exportStar:r0,__extends:Gw,__generator:e0,__importDefault:h0,__importStar:u0,__makeTemplateObject:c0,__metadata:Zw,__param:Yw,__read:Kh,__rest:Qw,__spread:i0,__spreadArrays:s0,__values:bo},Symbol.toStringTag,{value:"Module"})),xs=Lh(d0);var li={},so={},pi={};const f0=Object.freeze(Object.defineProperty({__proto__:null,IEvents:lr},Symbol.toStringTag,{value:"Module"})),g0=Lh(f0);var xu;function y0(){if(xu)return pi;xu=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.IHeartBeat=void 0;const o=g0;class t extends o.IEvents{constructor(s){super()}}return pi.IHeartBeat=t,pi}var Du;function Fh(){return Du||(Du=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),xs.__exportStar(y0(),o)}(so)),so}var no={},cr={},qu;function v0(){if(qu)return cr;qu=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.HEARTBEAT_EVENTS=cr.HEARTBEAT_INTERVAL=void 0;const o=q;return cr.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,cr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},cr}var ju;function Wh(){return ju||(ju=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),xs.__exportStar(v0(),o)}(no)),no}var Uu;function m0(){if(Uu)return li;Uu=1,Object.defineProperty(li,"__esModule",{value:!0}),li.HeartBeat=void 0;const o=xs,t=gt,r=q,s=Fh(),a=Wh();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new u(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return li.HeartBeat=u,li}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=xs;t.__exportStar(m0(),o),t.__exportStar(Fh(),o),t.__exportStar(Wh(),o)})(Mr);class w0 extends lr{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let _0=class extends lr{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}};class b0{constructor(t,r){this.logger=t,this.core=r}}let E0=class extends lr{constructor(t,r){super(),this.relayer=t,this.logger=r}},I0=class extends lr{constructor(t){super()}},P0=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}},S0=class extends lr{constructor(t,r){super(),this.relayer=t,this.logger=r}},O0=class extends lr{constructor(t,r){super(),this.core=t,this.logger=r}},R0=class{constructor(t,r){this.projectId=t,this.logger=r}},N0=class{constructor(t,r){this.projectId=t,this.logger=r}},$0=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},C0=class{constructor(t){this.client=t}};const T0=o=>JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),A0=o=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function x0(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return A0(o)}catch{return o}}function D0(o){return typeof o=="string"?o:T0(o)||""}var Mu=function(o,t,r){if(r||arguments.length===2)for(var s=0,a=t.length,u;s<a;s++)(u||!(s in t))&&(u||(u=Array.prototype.slice.call(t,0,s)),u[s]=t[s]);return o.concat(u||Array.prototype.slice.call(t))},q0=function(){function o(t,r,s){this.name=t,this.version=r,this.os=s,this.type="browser"}return o}(),j0=function(){function o(t){this.version=t,this.type="node",this.name="node",this.os=te.process.platform}return o}(),U0=function(){function o(t,r,s,a){this.name=t,this.version=r,this.os=s,this.bot=a,this.type="bot-device"}return o}(),M0=function(){function o(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return o}(),L0=function(){function o(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return o}(),k0=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,z0=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Lu=3,H0=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",k0]],ku=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function V0(o){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new L0:typeof navigator<"u"?F0(navigator.userAgent):B0()}function K0(o){return o!==""&&H0.reduce(function(t,r){var s=r[0],a=r[1];if(t)return t;var u=a.exec(o);return!!u&&[s,u]},!1)}function F0(o){var t=K0(o);if(!t)return null;var r=t[0],s=t[1];if(r==="searchbot")return new M0;var a=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);a?a.length<Lu&&(a=Mu(Mu([],a,!0),G0(Lu-a.length),!0)):a=[];var u=a.join("."),l=W0(o),g=z0.exec(o);return g&&g[1]?new U0(r,u,l,g[1]):new q0(r,u,l)}function W0(o){for(var t=0,r=ku.length;t<r;t++){var s=ku[t],a=s[0],u=s[1],l=u.exec(o);if(l)return a}return null}function B0(){var o=typeof te.process<"u"&&te.process.version;return o?new j0(te.process.version.slice(1)):null}function G0(o){for(var t=[],r=0;r<o;r++)t.push("0");return t}var ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=Bh=ne.getLocation=ne.getLocationOrThrow=Mo=ne.getNavigator=ne.getNavigatorOrThrow=Uo=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function dr(o){let t;return typeof window<"u"&&typeof window[o]<"u"&&(t=window[o]),t}ne.getFromWindow=dr;function Lr(o){const t=dr(o);if(!t)throw new Error(`${o} is not defined in Window`);return t}ne.getFromWindowOrThrow=Lr;function Q0(){return Lr("document")}ne.getDocumentOrThrow=Q0;function J0(){return dr("document")}var Uo=ne.getDocument=J0;function Y0(){return Lr("navigator")}ne.getNavigatorOrThrow=Y0;function Z0(){return dr("navigator")}var Mo=ne.getNavigator=Z0;function X0(){return Lr("location")}ne.getLocationOrThrow=X0;function e_(){return dr("location")}var Bh=ne.getLocation=e_;function t_(){return Lr("crypto")}ne.getCryptoOrThrow=t_;function r_(){return dr("crypto")}ne.getCrypto=r_;function i_(){return Lr("localStorage")}ne.getLocalStorageOrThrow=i_;function s_(){return dr("localStorage")}ne.getLocalStorage=s_;var Lo={};Object.defineProperty(Lo,"__esModule",{value:!0});var Gh=Lo.getWindowMetadata=void 0;const zu=ne;function n_(){let o,t;try{o=zu.getDocumentOrThrow(),t=zu.getLocationOrThrow()}catch{return null}function r(){const S=o.getElementsByTagName("link"),R=[];for(let j=0;j<S.length;j++){const A=S[j],K=A.getAttribute("rel");if(K&&K.toLowerCase().indexOf("icon")>-1){const x=A.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let B=t.protocol+"//"+t.host;if(x.indexOf("/")===0)B+=x;else{const pe=t.pathname.split("/");pe.pop();const J=pe.join("/");B+=J+"/"+x}R.push(B)}else if(x.indexOf("//")===0){const B=t.protocol+x;R.push(B)}else R.push(x)}}return R}function s(...S){const R=o.getElementsByTagName("meta");for(let j=0;j<R.length;j++){const A=R[j],K=["itemprop","property","name"].map(x=>A.getAttribute(x)).filter(x=>x?S.includes(x):!1);if(K.length&&K){const x=A.getAttribute("content");if(x)return x}}return""}function a(){let S=s("name","og:site_name","og:title","twitter:title");return S||(S=o.title),S}function u(){return s("description","og:description","twitter:description","keywords")}const l=a(),g=u(),w=t.origin,b=r();return{description:g,url:w,icons:b,name:l}}Gh=Lo.getWindowMetadata=n_;const o_=":";function a_(o){const[t,r]=o.split(o_);return{namespace:t,reference:r}}function Qh(o,t){return o.includes(":")?[o]:t.chains||[]}const Jh="base10",xe="base16",Eo="base64pad",ko="utf8",Yh=0,fr=1,c_=0,Hu=1,Io=12,zo=32;function u_(){const o=kh.generateKeyPair();return{privateKey:nt(o.secretKey,xe),publicKey:nt(o.publicKey,xe)}}function Po(){const o=zh.randomBytes(zo);return nt(o,xe)}function h_(o,t){const r=kh.sharedKey(ft(o,xe),ft(t,xe),!0),s=new Iw(xo.SHA256,r).expand(zo);return nt(s,xe)}function l_(o){const t=xo.hash(ft(o,xe));return nt(t,xe)}function qr(o){const t=xo.hash(ft(o,ko));return nt(t,xe)}function p_(o){return ft(`${o}`,Jh)}function Ii(o){return Number(nt(o,Jh))}function d_(o){const t=p_(typeof o.type<"u"?o.type:Yh);if(Ii(t)===fr&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?ft(o.senderPublicKey,xe):void 0,s=typeof o.iv<"u"?ft(o.iv,xe):zh.randomBytes(Io),a=new Hh.ChaCha20Poly1305(ft(o.symKey,xe)).seal(s,ft(o.message,ko));return g_({type:t,sealed:a,iv:s,senderPublicKey:r})}function f_(o){const t=new Hh.ChaCha20Poly1305(ft(o.symKey,xe)),{sealed:r,iv:s}=Os(o.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return nt(a,ko)}function g_(o){if(Ii(o.type)===fr){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return nt(Nu([o.type,o.senderPublicKey,o.iv,o.sealed]),Eo)}return nt(Nu([o.type,o.iv,o.sealed]),Eo)}function Os(o){const t=ft(o,Eo),r=t.slice(c_,Hu),s=Hu;if(Ii(r)===fr){const g=s+zo,w=g+Io,b=t.slice(s,g),N=t.slice(g,w),S=t.slice(w);return{type:r,sealed:S,iv:N,senderPublicKey:b}}const a=s+Io,u=t.slice(s,a),l=t.slice(a);return{type:r,sealed:l,iv:u}}function y_(o,t){const r=Os(o);return Zh({type:Ii(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?nt(r.senderPublicKey,xe):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Zh(o){const t=(o==null?void 0:o.type)||Yh;if(t===fr){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function Vu(o){return o.type===fr&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var v_=Object.defineProperty,Ku=Object.getOwnPropertySymbols,m_=Object.prototype.hasOwnProperty,w_=Object.prototype.propertyIsEnumerable,Fu=(o,t,r)=>t in o?v_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Wu=(o,t)=>{for(var r in t||(t={}))m_.call(t,r)&&Fu(o,r,t[r]);if(Ku)for(var r of Ku(t))w_.call(t,r)&&Fu(o,r,t[r]);return o};const __="ReactNative",Ge={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},b_="js";function Ho(){return typeof te.process<"u"&&typeof te.process.versions<"u"&&typeof te.process.versions.node<"u"}function kr(){return!Uo()&&!!Mo()&&navigator.product===__}function zr(){return!Ho()&&!!Mo()&&!!Uo()}function Pi(){return kr()?Ge.reactNative:Ho()?Ge.node:zr()?Ge.browser:Ge.unknown}function E_(){var o;try{return kr()&&typeof te.global<"u"&&typeof(te.global==null?void 0:te.global.Application)<"u"?(o=te.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function I_(o,t){let r=Ss.parse(o);return r=Wu(Wu({},r),t),o=Ss.stringify(r),o}function P_(){return Gh()||{name:"",description:"",url:"",icons:[""]}}function S_(){if(Pi()===Ge.reactNative&&typeof te.global<"u"&&typeof(te.global==null?void 0:te.global.Platform)<"u"){const{OS:r,Version:s}=te.global.Platform;return[r,s].join("-")}const o=V0();if(o===null)return"unknown";const t=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[t,o.name,o.version].join("-"):[t,o.version].join("-")}function O_(){var o;const t=Pi();return t===Ge.browser?[t,((o=Bh())==null?void 0:o.host)||"unknown"].join(":"):t}function R_(o,t,r){const s=S_(),a=O_();return[[o,t].join("-"),[b_,r].join("-"),s,a].join("/")}function N_({protocol:o,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:l,bundleId:g}){const w=r.split("?"),b=R_(o,t,s),N={auth:a,ua:b,projectId:u,useOnCloseEvent:l||void 0,origin:g||void 0},S=I_(w[1]||"",N);return w[0]+"?"+S}function ur(o,t){return o.filter(r=>t.includes(r)).length===o.length}function Xh(o){return Object.fromEntries(o.entries())}function el(o){return new Map(Object.entries(o))}function Ar(o=q.FIVE_MINUTES,t){const r=q.toMiliseconds(o||q.FIVE_MINUTES);let s,a,u;return{resolve:l=>{u&&s&&(clearTimeout(u),s(l))},reject:l=>{u&&a&&(clearTimeout(u),a(l))},done:()=>new Promise((l,g)=>{u=setTimeout(()=>{g(new Error(t))},r),s=l,a=g})}}function Ei(o,t,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),t);try{const l=await o;s(l)}catch(l){a(l)}clearTimeout(u)})}function tl(o,t){if(typeof t=="string"&&t.startsWith(`${o}:`))return t;if(o.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(o.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${o}`)}function $_(o){return tl("topic",o)}function C_(o){return tl("id",o)}function rl(o){const[t,r]=o.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function dt(o,t){return q.fromMiliseconds(Date.now()+q.toMiliseconds(o))}function Gt(o){return Date.now()>=q.toMiliseconds(o)}function ve(o,t){return`${o}${t?`:${t}`:""}`}function oo(o=[],t=[]){return[...new Set([...o,...t])]}async function T_({id:o,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${t}`,l=Pi();l===Ge.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):l===Ge.reactNative&&typeof(te.global==null?void 0:te.global.Linking)<"u"&&await te.global.Linking.openURL(u)}catch(s){console.error(s)}}async function A_(o,t){try{return await o.getItem(t)||(zr()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const x_="irn";function So(o){return(o==null?void 0:o.relay)||{protocol:x_}}function Is(o){const t=Pw[o];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${o}`);return t}var D_=Object.defineProperty,Bu=Object.getOwnPropertySymbols,q_=Object.prototype.hasOwnProperty,j_=Object.prototype.propertyIsEnumerable,Gu=(o,t,r)=>t in o?D_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,U_=(o,t)=>{for(var r in t||(t={}))q_.call(t,r)&&Gu(o,r,t[r]);if(Bu)for(var r of Bu(t))j_.call(t,r)&&Gu(o,r,t[r]);return o};function M_(o,t="-"){const r={},s="relay"+t;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),l=o[a];r[u]=l}}),r}function Qu(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const t=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,t),a=o.substring(t+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",l=Ss.parse(u);return{protocol:s,topic:L_(a[0]),version:parseInt(a[1],10),symKey:l.symKey,relay:M_(l)}}function L_(o){return o.startsWith("//")?o.substring(2):o}function k_(o,t="-"){const r="relay",s={};return Object.keys(o).forEach(a=>{const u=r+t+a;o[a]&&(s[u]=o[a])}),s}function z_(o){return`${o.protocol}:${o.topic}@${o.version}?`+Ss.stringify(U_({symKey:o.symKey},k_(o.relay)))}function Hr(o){const t=[];return o.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function H_(o){const t=[];return Object.values(o).forEach(r=>{t.push(...Hr(r.accounts))}),t}function V_(o,t){const r=[];return Object.values(o).forEach(s=>{Hr(s.accounts).includes(t)&&r.push(...s.methods)}),r}function K_(o,t){const r=[];return Object.values(o).forEach(s=>{Hr(s.accounts).includes(t)&&r.push(...s.events)}),r}function F_(o,t){const r=Ps(o,t);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(o))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return s}function Vo(o){return o.includes(":")}function mi(o){return Vo(o)?o.split(":")[0]:o}const W_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},B_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function $(o,t){const{message:r,code:s}=B_[o];return{message:t?`${r} ${t}`:r,code:s}}function ye(o,t){const{message:r,code:s}=W_[o];return{message:t?`${r} ${t}`:r,code:s}}function hr(o,t){return!!Array.isArray(o)}function jr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function ke(o){return typeof o>"u"}function be(o,t){return t&&ke(o)?!0:typeof o=="string"&&!!o.trim().length}function Ko(o,t){return typeof o=="number"&&!isNaN(o)}function G_(o,t){const{requiredNamespaces:r}=t,s=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return ur(a,s)?(s.forEach(l=>{const{accounts:g,methods:w,events:b}=o.namespaces[l],N=Hr(g),S=r[l];(!ur(Qh(l,S),N)||!ur(S.methods,w)||!ur(S.events,b))&&(u=!1)}),u):!1}function Rs(o){return be(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Q_(o){if(be(o,!1)&&o.includes(":")){const t=o.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Rs(r)}}return!1}function J_(o){if(be(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function Y_(o){var t;return(t=o==null?void 0:o.proposer)==null?void 0:t.publicKey}function Z_(o){return o==null?void 0:o.topic}function X_(o,t){let r=null;return be(o==null?void 0:o.publicKey,!1)||(r=$("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Ju(o){let t=!0;return hr(o)?o.length&&(t=o.every(r=>be(r,!1))):t=!1,t}function eb(o,t,r){let s=null;return hr(t)&&t.length?t.forEach(a=>{s||Rs(a)||(s=ye("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Rs(o)||(s=ye("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function tb(o,t,r){let s=null;return Object.entries(o).forEach(([a,u])=>{if(s)return;const l=eb(a,Qh(a,u),`${t} ${r}`);l&&(s=l)}),s}function rb(o,t){let r=null;return hr(o)?o.forEach(s=>{r||Q_(s)||(r=ye("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=ye("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function ib(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=rb(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function sb(o,t){let r=null;return Ju(o==null?void 0:o.methods)?Ju(o==null?void 0:o.events)||(r=ye("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=ye("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function il(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=sb(s,`${t}, namespace`);a&&(r=a)}),r}function nb(o,t,r){let s=null;if(o&&jr(o)){const a=il(o,t);a&&(s=a);const u=tb(o,t,r);u&&(s=u)}else s=$("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function Ps(o,t){let r=null;if(o&&jr(o)){const s=il(o,t);s&&(r=s);const a=ib(o,t);a&&(r=a)}else r=$("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function sl(o){return be(o.protocol,!0)}function ob(o,t){let r=!1;return o?o&&hr(o)&&o.length&&o.forEach(s=>{r=sl(s)}):r=!0,r}function ab(o){return typeof o=="number"}function Le(o){return typeof o<"u"&&typeof o!==null}function cb(o){return!(!o||typeof o!="object"||!o.code||!Ko(o.code)||!o.message||!be(o.message,!1))}function ub(o){return!(ke(o)||!be(o.method,!1))}function hb(o){return!(ke(o)||ke(o.result)&&ke(o.error)||!Ko(o.id)||!be(o.jsonrpc,!1))}function lb(o){return!(ke(o)||!be(o.name,!1))}function Yu(o,t){return!(!Rs(t)||!H_(o).includes(t))}function pb(o,t,r){return be(r,!1)?V_(o,t).includes(r):!1}function db(o,t,r){return be(r,!1)?K_(o,t).includes(r):!1}function Zu(o,t,r){let s=null;const a=fb(o),u=gb(t),l=Object.keys(a),g=Object.keys(u),w=Xu(Object.keys(o)),b=Xu(Object.keys(t)),N=w.filter(S=>!b.includes(S));return N.length&&(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${N.toString()}
      Received: ${Object.keys(t).toString()}`)),ur(l,g)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(S=>{if(!S.includes(":")||s)return;const R=Hr(t[S].accounts);R.includes(S)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${S}
        Required: ${S}
        Approved: ${R.toString()}`))}),l.forEach(S=>{s||(ur(a[S].methods,u[S].methods)?ur(a[S].events,u[S].events)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${S}`)):s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${S}`))}),s}function fb(o){const t={};return Object.keys(o).forEach(r=>{var s;r.includes(":")?t[r]=o[r]:(s=o[r].chains)==null||s.forEach(a=>{t[a]={methods:o[r].methods,events:o[r].events}})}),t}function Xu(o){return[...new Set(o.map(t=>t.includes(":")?t.split(":")[0]:t))]}function gb(o){const t={};return Object.keys(o).forEach(r=>{if(r.includes(":"))t[r]=o[r];else{const s=Hr(o[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),t}function yb(o,t){return Ko(o)&&o<=t.max&&o>=t.min}function eh(){const o=Pi();return new Promise(t=>{switch(o){case Ge.browser:t(vb());break;case Ge.reactNative:t(mb());break;case Ge.node:t(wb());break;default:t(!0)}})}function vb(){return zr()&&(navigator==null?void 0:navigator.onLine)}async function mb(){if(kr()&&typeof te.global<"u"&&te.global!=null&&te.global.NetInfo){const o=await(te.global==null?void 0:te.global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function wb(){return!0}function _b(o){switch(Pi()){case Ge.browser:bb(o);break;case Ge.reactNative:Eb(o);break}}function bb(o){!kr()&&zr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Eb(o){var t;kr()&&typeof te.global<"u"&&te.global!=null&&te.global.NetInfo&&((t=te.global)==null||t.NetInfo.addEventListener(r=>o(r==null?void 0:r.isConnected)))}const ao={};let ws=class{static get(t){return ao[t]}static set(t,r){ao[t]=r}static delete(t){delete ao[t]}};class Dt extends Sw{constructor(t){super(t),this.events=new gt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Dr(t.method,t.params||[],t.id||Vh().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{bt(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),$s(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var Ib={};function Pb(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),l=u.charCodeAt(0);if(r[l]!==255)throw new TypeError(u+" is ambiguous");r[l]=a}var g=o.length,w=o.charAt(0),b=Math.log(g)/Math.log(256),N=Math.log(256)/Math.log(g);function S(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var K=0,x=0,B=0,pe=A.length;B!==pe&&A[B]===0;)B++,K++;for(var J=(pe-B)*N+1>>>0,Y=new Uint8Array(J);B!==pe;){for(var ae=A[B],Ne=0,de=J-1;(ae!==0||Ne<x)&&de!==-1;de--,Ne++)ae+=256*Y[de]>>>0,Y[de]=ae%g>>>0,ae=ae/g>>>0;if(ae!==0)throw new Error("Non-zero carry");x=Ne,B++}for(var $e=J-x;$e!==J&&Y[$e]===0;)$e++;for(var jt=w.repeat(K);$e<J;++$e)jt+=o.charAt(Y[$e]);return jt}function R(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var K=0;if(A[K]!==" "){for(var x=0,B=0;A[K]===w;)x++,K++;for(var pe=(A.length-K)*b+1>>>0,J=new Uint8Array(pe);A[K];){var Y=r[A.charCodeAt(K)];if(Y===255)return;for(var ae=0,Ne=pe-1;(Y!==0||ae<B)&&Ne!==-1;Ne--,ae++)Y+=g*J[Ne]>>>0,J[Ne]=Y%256>>>0,Y=Y/256>>>0;if(Y!==0)throw new Error("Non-zero carry");B=ae,K++}if(A[K]!==" "){for(var de=pe-B;de!==pe&&J[de]===0;)de++;for(var $e=new Uint8Array(x+(pe-de)),jt=x;de!==pe;)$e[jt++]=J[de++];return $e}}}function j(A){var K=R(A);if(K)return K;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:R,decode:j}}var Sb=Pb,Ob=Sb;const nl=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Rb=o=>new TextEncoder().encode(o),Nb=o=>new TextDecoder().decode(o);class $b{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Cb{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ol(this,t)}}class Tb{constructor(t){this.decoders=t}or(t){return ol(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ol=(o,t)=>new Tb({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class Ab{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new $b(t,r,s),this.decoder=new Cb(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Ds=({name:o,prefix:t,encode:r,decode:s})=>new Ab(o,t,r,s),Si=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=Ob(r,t);return Ds({prefix:o,name:t,encode:s,decode:u=>nl(a(u))})},xb=(o,t,r,s)=>{const a={};for(let N=0;N<t.length;++N)a[t[N]]=N;let u=o.length;for(;o[u-1]==="=";)--u;const l=new Uint8Array(u*r/8|0);let g=0,w=0,b=0;for(let N=0;N<u;++N){const S=a[o[N]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|S,g+=r,g>=8&&(g-=8,l[b++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return l},Db=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",l=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],l+=8;l>r;)l-=r,u+=t[a&g>>l];if(l&&(u+=t[a&g<<r-l]),s)for(;u.length*r&7;)u+="=";return u},Pe=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Ds({prefix:t,name:o,encode(a){return Db(a,s,r)},decode(a){return xb(a,s,r,o)}}),qb=Ds({prefix:"\0",name:"identity",encode:o=>Nb(o),decode:o=>Rb(o)});var jb=Object.freeze({__proto__:null,identity:qb});const Ub=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Mb=Object.freeze({__proto__:null,base2:Ub});const Lb=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var kb=Object.freeze({__proto__:null,base8:Lb});const zb=Si({prefix:"9",name:"base10",alphabet:"0123456789"});var Hb=Object.freeze({__proto__:null,base10:zb});const Vb=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kb=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Fb=Object.freeze({__proto__:null,base16:Vb,base16upper:Kb});const Wb=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Bb=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gb=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Qb=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Jb=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Yb=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Zb=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xb=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),e1=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var t1=Object.freeze({__proto__:null,base32:Wb,base32upper:Bb,base32pad:Gb,base32padupper:Qb,base32hex:Jb,base32hexupper:Yb,base32hexpad:Zb,base32hexpadupper:Xb,base32z:e1});const r1=Si({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i1=Si({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var s1=Object.freeze({__proto__:null,base36:r1,base36upper:i1});const n1=Si({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),o1=Si({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var a1=Object.freeze({__proto__:null,base58btc:n1,base58flickr:o1});const c1=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),u1=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),h1=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),l1=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var p1=Object.freeze({__proto__:null,base64:c1,base64pad:u1,base64url:h1,base64urlpad:l1});const al=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),d1=al.reduce((o,t,r)=>(o[r]=t,o),[]),f1=al.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function g1(o){return o.reduce((t,r)=>(t+=d1[r],t),"")}function y1(o){const t=[];for(const r of o){const s=f1[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const v1=Ds({prefix:"🚀",name:"base256emoji",encode:g1,decode:y1});var m1=Object.freeze({__proto__:null,base256emoji:v1}),w1=cl,th=128,_1=127,b1=~_1,E1=Math.pow(2,31);function cl(o,t,r){t=t||[],r=r||0;for(var s=r;o>=E1;)t[r++]=o&255|th,o/=128;for(;o&b1;)t[r++]=o&255|th,o>>>=7;return t[r]=o|0,cl.bytes=r-s+1,t}var I1=Oo,P1=128,rh=127;function Oo(o,s){var r=0,s=s||0,a=0,u=s,l,g=o.length;do{if(u>=g)throw Oo.bytes=0,new RangeError("Could not decode varint");l=o[u++],r+=a<28?(l&rh)<<a:(l&rh)*Math.pow(2,a),a+=7}while(l>=P1);return Oo.bytes=u-s,r}var S1=Math.pow(2,7),O1=Math.pow(2,14),R1=Math.pow(2,21),N1=Math.pow(2,28),$1=Math.pow(2,35),C1=Math.pow(2,42),T1=Math.pow(2,49),A1=Math.pow(2,56),x1=Math.pow(2,63),D1=function(o){return o<S1?1:o<O1?2:o<R1?3:o<N1?4:o<$1?5:o<C1?6:o<T1?7:o<A1?8:o<x1?9:10},q1={encode:w1,decode:I1,encodingLength:D1},ul=q1;const ih=(o,t,r=0)=>(ul.encode(o,t,r),t),sh=o=>ul.encodingLength(o),Ro=(o,t)=>{const r=t.byteLength,s=sh(o),a=s+sh(r),u=new Uint8Array(a+r);return ih(o,u,0),ih(r,u,s),u.set(t,a),new j1(o,r,t,u)};class j1{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const hl=({name:o,code:t,encode:r})=>new U1(o,t,r);class U1{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Ro(this.code,r):r.then(s=>Ro(this.code,s))}else throw Error("Unknown type, must be binary type")}}const ll=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),M1=hl({name:"sha2-256",code:18,encode:ll("SHA-256")}),L1=hl({name:"sha2-512",code:19,encode:ll("SHA-512")});var k1=Object.freeze({__proto__:null,sha256:M1,sha512:L1});const pl=0,z1="identity",dl=nl,H1=o=>Ro(pl,dl(o)),V1={code:pl,name:z1,encode:dl,digest:H1};var K1=Object.freeze({__proto__:null,identity:V1});new TextEncoder,new TextDecoder;const nh={...jb,...Mb,...kb,...Hb,...Fb,...t1,...s1,...a1,...p1,...m1};({...k1,...K1});function fl(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function F1(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?fl(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function gl(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const oh=gl("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),co=gl("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=F1(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),W1={utf8:oh,"utf-8":oh,hex:nh.base16,latin1:co,ascii:co,binary:co,...nh};function B1(o,t="utf8"){const r=W1[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?fl(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const yl="wc",G1=2,Fo="core",Qt=`${yl}@2:${Fo}:`,Q1={name:Fo,logger:"error"},J1={database:":memory:"},Y1="crypto",ah="client_ed25519_seed",Z1=q.ONE_DAY,X1="keychain",eE="0.3",tE="messages",rE="0.3",iE=q.SIX_HOURS,sE="publisher",vl="irn",nE="error",ml="wss://relay.walletconnect.com",ch="wss://relay.walletconnect.org",oE="relayer",Re={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},aE="_subscription",At={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},cE=q.ONE_SECOND,uE="2.11.0",hE=1e4,lE="0.3",pE="WALLETCONNECT_CLIENT_ID",pt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},dE="subscription",fE="0.3",gE=q.FIVE_SECONDS*1e3,yE="pairing",vE="0.3",di={wc_pairingDelete:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:q.ONE_DAY,prompt:!1,tag:0},res:{ttl:q.ONE_DAY,prompt:!1,tag:0}}},wi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},_t={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},mE="history",wE="0.3",_E="expirer",st={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},bE="0.3",uo="verify-api",xr="https://verify.walletconnect.com",No="https://verify.walletconnect.org",EE=[xr,No],IE="echo",PE="https://echo.walletconnect.com";class SE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=X1,this.version=eE,this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=$("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Xh(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?el(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class OE{constructor(t,r,s){this.core=t,this.logger=r,this.name=Y1,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=$u(a);return Nw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=u_();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),l=$u(u),g=Po();return await $w(g,a,Z1,l)},this.generateSharedKey=(a,u,l)=>{this.isInitialized();const g=this.getPrivateKey(a),w=h_(g,u);return this.setSymKey(w,l)},this.setSymKey=async(a,u)=>{this.isInitialized();const l=u||l_(a);return await this.keychain.set(l,a),l},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,l)=>{this.isInitialized();const g=Zh(l),w=D0(u);if(Vu(g)){const R=g.senderPublicKey,j=g.receiverPublicKey;a=await this.generateSharedKey(R,j)}const b=this.getSymKey(a),{type:N,senderPublicKey:S}=g;return d_({type:N,symKey:b,message:w,senderPublicKey:S})},this.decode=async(a,u,l)=>{this.isInitialized();const g=y_(u,l);if(Vu(g)){const w=g.receiverPublicKey,b=g.senderPublicKey;a=await this.generateSharedKey(w,b)}try{const w=this.getSymKey(a),b=f_({symKey:w,encoded:u});return x0(b)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=Os(a);return Ii(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Os(a);return u.senderPublicKey?nt(u.senderPublicKey,xe):void 0},this.core=t,this.logger=ze(r,this.name),this.keychain=s||new SE(this.core,this.logger)}get context(){return Qe(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(ah)}catch{t=Po(),await this.keychain.set(ah,t)}return B1(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class RE extends b0{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=tE,this.version=rE,this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=qr(a);let l=this.messages.get(s);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=a,this.messages.set(s,l),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),l=qr(a);return typeof u[l]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=ze(t,this.name),this.core=r}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Xh(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?el(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class NE extends E0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new gt.EventEmitter,this.name=sE,this.queue=new Map,this.publishTimeout=q.toMiliseconds(q.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const g=(u==null?void 0:u.ttl)||iE,w=So(u),b=(u==null?void 0:u.prompt)||!1,N=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||Vh().toString(),R={topic:s,message:a,opts:{ttl:g,relay:w,prompt:b,tag:N,id:S}},j=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await Ei(this.rpcPublish(s,a,g,w,b,N,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Re.publish,R)}catch(A){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(S),A;return}finally{clearTimeout(j)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=ze(r,this.name),this.registerEventListeners()}get context(){return Qe(this.logger)}rpcPublish(t,r,s,a,u,l,g){var w,b,N,S;const R={method:Is(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:l},id:g};return ke((w=R.params)==null?void 0:w.prompt)&&((b=R.params)==null||delete b.prompt),ke((N=R.params)==null?void 0:N.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Re.connection_stalled);return}this.checkQueue()}),this.relayer.on(Re.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class $E{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var CE=Object.defineProperty,TE=Object.defineProperties,AE=Object.getOwnPropertyDescriptors,uh=Object.getOwnPropertySymbols,xE=Object.prototype.hasOwnProperty,DE=Object.prototype.propertyIsEnumerable,hh=(o,t,r)=>t in o?CE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,fi=(o,t)=>{for(var r in t||(t={}))xE.call(t,r)&&hh(o,r,t[r]);if(uh)for(var r of uh(t))DE.call(t,r)&&hh(o,r,t[r]);return o},ho=(o,t)=>TE(o,AE(t));class qE extends S0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new $E,this.events=new gt.EventEmitter,this.name=dE,this.version=fE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Qt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=So(a),l={topic:s,relay:u};this.pending.set(s,l);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const l=new q.Watch;l.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),a(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=gE&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=ze(r,this.name),this.clientId=""}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=So(s);await this.rpcUnsubscribe(t,r,a);const u=ye("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Is(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Ei(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Re.connection_stalled)}return qr(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Is(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Ei(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Re.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Is(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,ho(fi({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,fi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,fi({},r)),this.topicMap.set(r.topic,t),this.events.emit(pt.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(pt.deleted,ho(fi({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(pt.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(pt.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);hr(r)&&this.onBatchSubscribe(r.map((s,a)=>ho(fi({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Re.connect,async()=>{await this.onConnect()}),this.relayer.on(Re.disconnect,()=>{this.onDisconnect()}),this.events.on(pt.created,async t=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(pt.deleted,async t=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var jE=Object.defineProperty,lh=Object.getOwnPropertySymbols,UE=Object.prototype.hasOwnProperty,ME=Object.prototype.propertyIsEnumerable,ph=(o,t,r)=>t in o?jE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,LE=(o,t)=>{for(var r in t||(t={}))UE.call(t,r)&&ph(o,r,t[r]);if(lh)for(var r of lh(t))ME.call(t,r)&&ph(o,r,t[r]);return o};class kE extends I0{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new gt.EventEmitter,this.name=oE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Re.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Re.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(At.payload,this.onPayloadHandler),this.provider.on(At.connect,this.onConnectHandler),this.provider.on(At.disconnect,this.onDisconnectHandler),this.provider.on(At.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?ze(t.logger,this.name):Cs(Ts({level:t.logger||nE})),this.messages=new RE(this.logger,t.core),this.subscriber=new qE(this,this.logger),this.publisher=new NE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||ml,this.projectId=t.projectId,this.bundleId=E_(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ch}...`),await this.restartTransport(ch)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},hE)}get context(){return Qe(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const l=g=>{g.topic===t&&(this.subscriber.off(pt.created,l),u())};return await Promise.all([new Promise(g=>{u=g,this.subscriber.on(pt.created,l)}),new Promise(async g=>{a=await this.subscriber.subscribe(t,r),g()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ei(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(pt.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Ei(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(At.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await eh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Dt(new Cw(N_({sdkVersion:uE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Do(t)){if(!t.method.endsWith(aE))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,l={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(LE({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else $s(t)&&this.events.emit(Re.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Re.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=As(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(At.payload,this.onPayloadHandler),this.provider.off(At.connect,this.onConnectHandler),this.provider.off(At.disconnect,this.onDisconnectHandler),this.provider.off(At.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Re.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await eh();_b(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Re.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},q.toMiliseconds(cE)))}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var zE=Object.defineProperty,dh=Object.getOwnPropertySymbols,HE=Object.prototype.hasOwnProperty,VE=Object.prototype.propertyIsEnumerable,fh=(o,t,r)=>t in o?zE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,gh=(o,t)=>{for(var r in t||(t={}))HE.call(t,r)&&fh(o,r,t[r]);if(dh)for(var r of dh(t))VE.call(t,r)&&fh(o,r,t[r]);return o};class qs extends P0{constructor(t,r,s,a=Qt,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=lE,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!ke(l)?this.map.set(this.getKey(l),l):Y_(l)?this.map.set(l.id,l):Z_(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,g)=>{this.isInitialized(),this.map.has(l)?await this.update(l,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:g}),this.map.set(l,g),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(g=>Object.keys(l).every(w=>Ow(g[w],l[w]))):this.values),this.update=async(l,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:g});const w=gh(gh({},this.getData(l)),g);this.map.set(l,w),await this.persist()},this.delete=async(l,g)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:g}),this.map.delete(l),await this.persist())},this.logger=ze(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class KE{constructor(t,r){this.core=t,this.logger=r,this.name=yE,this.version=vE,this.events=new Ao,this.initialized=!1,this.storagePrefix=Qt,this.ignoredPayloadTypes=[fr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Po(),a=await this.core.crypto.setSymKey(s),u=dt(q.FIVE_MINUTES),l={protocol:vl},g={topic:a,expiry:u,relay:l,active:!1},w=z_({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:l});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:l}=Qu(s.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=dt(q.FIVE_MINUTES),b={topic:a,relay:l,expiry:w,active:!1};return await this.pairings.set(a,b),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(wi.create,b),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:l})),b},this.activate=async({topic:s})=>{this.isInitialized();const a=dt(q.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:l,resolve:g,reject:w}=Ar();this.events.once(ve("pairing_ping",u),({error:b})=>{b?w(b):g()}),await l()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",ye("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const l=Dr(a,u),g=await this.core.crypto.encode(s,l),w=di[a].req;return this.core.history.set(s,l),this.core.relayer.publish(s,g,w),l.id},this.sendResult=async(s,a,u)=>{const l=As(s,u),g=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),b=di[w.request.method].res;await this.core.relayer.publish(a,g,b),await this.core.history.resolve(l)},this.sendError=async(s,a,u)=>{const l=qo(s,u),g=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),b=di[w.request.method]?di[w.request.method].res:di.unregistered_method.res;await this.core.relayer.publish(a,g,b),await this.core.history.resolve(l)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ye("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Gt(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,l=(await this.core.history.get(a,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(wi.ping,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{Bt(a)?this.events.emit(ve("pairing_ping",u),{}):bt(a)&&this.events.emit(ve("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(wi.delete,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:l}=a;try{if(this.registeredMethods.includes(l))return;const g=ye("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(ye("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!Le(s)){const{message:l}=$("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(l)}if(!J_(s.uri)){const{message:l}=$("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(l)}const u=Qu(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:l}=$("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(u!=null&&u.symKey)){const{message:l}=$("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async s=>{if(!Le(s)){const{message:u}=$("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!Le(s)){const{message:u}=$("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!be(s,!1)){const{message:a}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Gt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=$("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=ze(r,this.name),this.pairings=new qs(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Qe(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Re.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Do(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):$s(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(st.expired,async t=>{const{topic:r}=rl(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(wi.expire,{topic:r}))})}}class FE extends _0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new gt.EventEmitter,this.name=mE,this.version=wE,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const l={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:dt(q.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(_t.created,l)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=bt(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(_t.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(_t.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Dr(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_t.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(_t.created,t=>{const r=_t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(_t.updated,t=>{const r=_t.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(_t.deleted,t=>{const r=_t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{q.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class WE extends O0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new gt.EventEmitter,this.name=_E,this.version=bE,this.cached=[],this.initialized=!1,this.storagePrefix=Qt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),l={target:u,expiry:a};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(st.created,{target:u,expiration:l})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(st.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return $_(t);if(typeof t=="number")return C_(t);const{message:r}=$("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(st.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;q.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(st.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(st.created,t=>{const r=st.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(st.expired,t=>{const r=st.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(st.deleted,t=>{const r=st.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class BE extends R0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=uo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||kr()||!zr())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=No;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(l){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(l),u=await this.fetchAttestation(s.attestationId,No)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(q.ONE_SECOND*2),l=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),l.status===200?await l.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(uo))return u();window.addEventListener("message",a);const l=document.createElement("iframe");l.id=uo,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,s=u}),new Promise((u,l)=>setTimeout(()=>{window.removeEventListener("message",a),l("verify iframe load timeout")},q.toMiliseconds(q.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||xr;return EE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${xr}`),a=xr),a},this.logger=ze(r,this.name),this.verifyUrl=xr,this.abortController=new AbortController,this.isDevEnv=Ho()&&Ib.IS_VITEST}get context(){return Qe(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),q.toMiliseconds(t))}}class GE extends N0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=IE,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:l,enableEncrypted:g=!1}=s,w=`${PE}/${this.projectId}/clients`;await Tw(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:l,token:u,always_raw:g})})},this.logger=ze(r,this.context)}}var QE=Object.defineProperty,yh=Object.getOwnPropertySymbols,JE=Object.prototype.hasOwnProperty,YE=Object.prototype.propertyIsEnumerable,vh=(o,t,r)=>t in o?QE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,mh=(o,t)=>{for(var r in t||(t={}))JE.call(t,r)&&vh(o,r,t[r]);if(yh)for(var r of yh(t))YE.call(t,r)&&vh(o,r,t[r]);return o};class Wo extends w0{constructor(t){super(t),this.protocol=yl,this.version=G1,this.name=Fo,this.events=new gt.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||ml,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Cs(Ts({level:(t==null?void 0:t.logger)||Q1.logger}));this.logger=ze(r,this.name),this.heartbeat=new Mr.HeartBeat,this.crypto=new OE(this,this.logger,t==null?void 0:t.keychain),this.history=new FE(this,this.logger),this.expirer=new WE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Rw(mh(mh({},J1),t==null?void 0:t.storageOptions)),this.relayer=new kE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new KE(this,this.logger),this.verify=new BE(this.projectId||"",this.logger),this.echoClient=new GE(this.projectId||"",this.logger)}static async init(t){const r=new Wo(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(pE,s),r}get context(){return Qe(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const ZE=Wo,wl="wc",_l=2,bl="client",Bo=`${wl}@${_l}:${bl}:`,lo={name:bl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},wh="WALLETCONNECT_DEEPLINK_CHOICE",XE="proposal",El="Proposal expired",eI="session",_s=q.SEVEN_DAYS,tI="engine",gi={wc_sessionPropose:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:q.THIRTY_SECONDS,prompt:!1,tag:1115}}},po={min:q.FIVE_MINUTES,max:q.SEVEN_DAYS},xt={idle:"IDLE",active:"ACTIVE"},rI="request",iI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var sI=Object.defineProperty,nI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,_h=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,cI=Object.prototype.propertyIsEnumerable,bh=(o,t,r)=>t in o?sI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Me=(o,t)=>{for(var r in t||(t={}))aI.call(t,r)&&bh(o,r,t[r]);if(_h)for(var r of _h(t))cI.call(t,r)&&bh(o,r,t[r]);return o},yi=(o,t)=>nI(o,oI(t));class uI extends C0{constructor(t){super(t),this.name=tI,this.events=new Ao,this.initialized=!1,this.ignoredPayloadTypes=[fr],this.requestQueue={state:xt.idle,queue:[]},this.sessionRequestQueue={state:xt.idle,queue:[]},this.requestQueueDelay=q.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(gi)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},q.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=yi(Me({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:g,relays:w}=s;let b=a,N,S=!1;if(b&&(S=this.client.core.pairing.pairings.get(b).active),!b||!S){const{topic:J,uri:Y}=await this.client.core.pairing.create();b=J,N=Y}const R=await this.client.core.crypto.generateKeyPair(),j=Me({requiredNamespaces:u,optionalNamespaces:l,relays:w??[{protocol:vl}],proposer:{publicKey:R,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:A,resolve:K,done:x}=Ar(q.FIVE_MINUTES,El);if(this.events.once(ve("session_connect"),async({error:J,session:Y})=>{if(J)A(J);else if(Y){Y.self.publicKey=R;const ae=yi(Me({},Y),{requiredNamespaces:Y.requiredNamespaces,optionalNamespaces:Y.optionalNamespaces});await this.client.session.set(Y.topic,ae),await this.setExpiry(Y.topic,Y.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:Y.peer.metadata}),K(ae)}}),!b){const{message:J}=$("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(J)}const B=await this.sendRequest({topic:b,method:"wc_sessionPropose",params:j}),pe=dt(q.FIVE_MINUTES);return await this.setProposal(B,Me({id:B,expiry:pe},j)),{uri:N,approval:x}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:l}=r,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:b,requiredNamespaces:N,optionalNamespaces:S}=g;w=w||"",jr(N)||(N=F_(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),j=b.publicKey,A=await this.client.core.crypto.generateSharedKey(R,j);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:b.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,ye("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const K=Me({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:N,optionalNamespaces:S,pairingTopic:w,controller:{publicKey:R,metadata:this.client.metadata},expiry:dt(_s)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(A),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const x=yi(Me({},K),{topic:A,pairingTopic:w,acknowledged:!1,self:K.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:R});return await this.client.session.set(A,x),await this.setExpiry(A,dt(_s)),{topic:A,acknowledged:()=>new Promise(B=>setTimeout(()=>B(this.client.session.get(A)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,ye("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:l,resolve:g,reject:w}=Ar();return this.events.once(ve("session_update",u),({error:b})=>{b?w(b):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:l,reject:g}=Ar();return this.events.once(ve("session_extend",a),({error:w})=>{w?g(w):l()}),await this.setExpiry(s,dt(_s)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:l}=r,g=Aw(),{done:w,resolve:b,reject:N}=Ar(l,"Request expired. Please try again.");return this.events.once(ve("session_request",g),({error:S,result:R})=>{S?N(S):b(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:l,throwOnFailedPublish:!0}).catch(R=>N(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:g}),S()}),new Promise(async S=>{const R=await A_(this.client.core.storage,wh);T_({id:g,topic:u,wcDeepLink:R}),S()}),w()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;Bt(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):bt(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:l,reject:g}=Ar();this.events.once(ve("session_ping",a),({error:w})=>{w?g(w):l()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ye("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>G_(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var l,g;return((l=u.peerMetadata)==null?void 0:l.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,ye("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(wh).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,ye("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,ye("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=xt.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=gi.wc_sessionRequest.req.ttl,{id:a,topic:u,params:l,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:l,verifyContext:g}),s&&this.client.core.expirer.set(a,dt(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:l,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:b}=r,N=Dr(a,u,w);if(zr()&&iI.includes(a)){const j=qr(JSON.stringify(N));this.client.core.verify.register({attestationId:j})}const S=await this.client.core.crypto.encode(s,N),R=gi[a].req;return l&&(R.ttl=l),g&&(R.id=g),this.client.core.history.set(s,N),b?(R.internal=yi(Me({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(j=>this.client.logger.error(j)),N.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:l}=r,g=As(s,u),w=await this.client.core.crypto.encode(a,g),b=await this.client.core.history.get(a,s),N=gi[b.request.method].res;l?(N.internal=yi(Me({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,N)):this.client.core.relayer.publish(a,w,N).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,a)=>{const u=qo(r,a),l=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),w=gi[g.request.method].res;this.client.core.relayer.publish(s,l,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Gt(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Gt(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===xt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=xt.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=xt.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=$("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(Me({},s.params));const l=dt(q.FIVE_MINUTES),g=Me({id:u,pairingTopic:r,expiry:l},a);await this.setProposal(u,g);const w=qr(JSON.stringify(s)),b=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:b})}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Bt(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const l=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const g=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const b=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const N=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:N}),await this.client.core.pairing.activate({topic:r})}else bt(s)&&(await this.client.proposal.delete(a,ye("USER_DISCONNECTED")),this.events.emit(ve("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:g,expiry:w,namespaces:b,requiredNamespaces:N,optionalNamespaces:S,sessionProperties:R,pairingTopic:j}=s.params,A=Me({topic:r,relay:l,expiry:w,namespaces:b,acknowledged:!0,pairingTopic:j,requiredNamespaces:N,optionalNamespaces:S,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(ve("session_connect"),{session:A}),this.cleanupDuplicatePairings(A)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Bt(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ve("session_approve",a),{})):bt(s)&&(await this.client.session.delete(r,ye("USER_DISCONNECTED")),this.events.emit(ve("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const l=`${r}_session_update`,g=ws.get(l);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Me({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),ws.set(l,u)}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Bt(s)?this.events.emit(ve("session_update",a),{}):bt(s)&&this.events.emit(ve("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,dt(_s)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Bt(s)?this.events.emit(ve("session_extend",a),{}):bt(s)&&this.events.emit(ve("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Bt(s)?this.events.emit(ve("session_ping",a),{}):bt(s)&&this.events.emit(ve("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Re.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(Me({topic:r},u));const l=qr(JSON.stringify(Dr("wc_sessionRequest",u,a))),g=this.client.session.get(r),w=await this.getVerifyContext(l,g.peer.metadata),b={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(b),this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue()}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Bt(s)?this.events.emit(ve("session_request",a),{result:s.result}):bt(s)&&this.events.emit(ve("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const l=`${r}_session_event_${u.event.name}`,g=ws.get(l);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Me({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),ws.set(l,a)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=xt.idle,this.processSessionRequestQueue()},q.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===xt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=xt.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Dr("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!Le(r)){const{message:w}=$("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:l,relays:g}=r;if(ke(s)||await this.isValidPairingTopic(s),!ob(g)){const{message:w}=$("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!ke(a)&&jr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ke(u)&&jr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),ke(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=nb(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Le(r))throw new Error($("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:l}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=Ps(a,"approve()");if(w)throw new Error(w.message);const b=Zu(g.requiredNamespaces,a,"approve()");if(b)throw new Error(b.message);if(!be(u,!0)){const{message:N}=$("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(N)}ke(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!Le(r)){const{message:u}=$("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!cb(a)){const{message:u}=$("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!Le(r)){const{message:b}=$("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:s,controller:a,namespaces:u,expiry:l}=r;if(!sl(s)){const{message:b}=$("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const g=X_(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Ps(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Gt(l)){const{message:b}=$("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!Le(r)){const{message:w}=$("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),l=Ps(a,"update()");if(l)throw new Error(l.message);const g=Zu(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!Le(r)){const{message:a}=$("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!Le(r)){const{message:w}=$("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:a,chainId:u,expiry:l}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!Yu(g,u)){const{message:w}=$("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!ub(a)){const{message:w}=$("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!pb(g,u,a.method)){const{message:w}=$("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(l&&!yb(l,po)){const{message:w}=$("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${po.min} and ${po.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var s;if(!Le(r)){const{message:l}=$("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(l){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),l}if(!hb(u)){const{message:l}=$("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!Le(r)){const{message:a}=$("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!Le(r)){const{message:g}=$("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:l}=this.client.session.get(s);if(!Yu(l,u)){const{message:g}=$("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!lb(a)){const{message:g}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!db(l,u,a.name)){const{message:g}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!Le(r)){const{message:a}=$("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||xr,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!be(a,!1)){const{message:u}=$("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Re.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Do(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):$s(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(st.expired,async t=>{const{topic:r,id:s}=rl(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,$("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(wi.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!be(t,!1)){const{message:r}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=$("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!be(t,!1)){const{message:r}=$("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=$("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(be(t,!1)){const{message:r}=$("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=$("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!ab(t)){const{message:r}=$("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Gt(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=$("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class hI extends qs{constructor(t,r){super(t,r,XE,Bo),this.core=t,this.logger=r}}class lI extends qs{constructor(t,r){super(t,r,eI,Bo),this.core=t,this.logger=r}}class pI extends qs{constructor(t,r){super(t,r,rI,Bo,s=>s.id),this.core=t,this.logger=r}}let dI=class Il extends $0{constructor(t){super(t),this.protocol=wl,this.version=_l,this.name=lo.name,this.events=new gt.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||lo.name,this.metadata=(t==null?void 0:t.metadata)||P_();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Cs(Ts({level:(t==null?void 0:t.logger)||lo.logger}));this.core=(t==null?void 0:t.core)||new ZE(t),this.logger=ze(r,this.name),this.session=new lI(this.core,this.logger),this.proposal=new hI(this.core,this.logger),this.pendingRequest=new pI(this.core,this.logger),this.engine=new uI(this)}static async init(t){const r=new Il(t);return await r.initialize(),r}get context(){return Qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const fI=o=>JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),gI=o=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function yI(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return gI(o)}catch{return o}}function Eh(o){return typeof o=="string"?o:fI(o)||""}var vI=Object.defineProperty,mI=Object.defineProperties,wI=Object.getOwnPropertyDescriptors,Ih=Object.getOwnPropertySymbols,_I=Object.prototype.hasOwnProperty,bI=Object.prototype.propertyIsEnumerable,Ph=(o,t,r)=>t in o?vI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Sh=(o,t)=>{for(var r in t||(t={}))_I.call(t,r)&&Ph(o,r,t[r]);if(Ih)for(var r of Ih(t))bI.call(t,r)&&Ph(o,r,t[r]);return o},Oh=(o,t)=>mI(o,wI(t));const EI={Accept:"application/json","Content-Type":"application/json"},II="POST",Rh={headers:EI,method:II},Nh=10;let Yt=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new gt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Cu(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=Eh(t),s=await(await Tu(this.url,Oh(Sh({},Rh),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!Cu(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Eh({id:1,jsonrpc:"2.0",method:"test",params:[]});await Tu(t,Oh(Sh({},Rh),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?yI(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=qo(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return xw(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Nh&&this.events.setMaxListeners(Nh)}};const $h="error",PI="wss://relay.walletconnect.com",SI="wc",OI="universal_provider",Ch=`${SI}@2:${OI}:`,RI="https://rpc.walletconnect.com/v1/",qt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var vi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof te.global<"u"?te.global:typeof self<"u"?self:{},$o={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,N="__lodash_placeholder__",S=1,R=2,j=4,A=1,K=2,x=1,B=2,pe=4,J=8,Y=16,ae=32,Ne=64,de=128,$e=256,jt=512,Ol=30,Rl="...",Nl=800,$l=16,Jo=1,Cl=2,Tl=3,Zt=1/0,Ut=9007199254740991,Al=17976931348623157e292,Oi=NaN,yt=4294967295,xl=yt-1,Dl=yt>>>1,ql=[["ary",de],["bind",x],["bindKey",B],["curry",J],["curryRight",Y],["flip",jt],["partial",ae],["partialRight",Ne],["rearg",$e]],yr="[object Arguments]",Ri="[object Array]",jl="[object AsyncFunction]",Vr="[object Boolean]",Kr="[object Date]",Ul="[object DOMException]",Ni="[object Error]",$i="[object Function]",Yo="[object GeneratorFunction]",ot="[object Map]",Fr="[object Number]",Ml="[object Null]",Et="[object Object]",Zo="[object Promise]",Ll="[object Proxy]",Wr="[object RegExp]",at="[object Set]",Br="[object String]",Ci="[object Symbol]",kl="[object Undefined]",Gr="[object WeakMap]",zl="[object WeakSet]",Qr="[object ArrayBuffer]",vr="[object DataView]",js="[object Float32Array]",Us="[object Float64Array]",Ms="[object Int8Array]",Ls="[object Int16Array]",ks="[object Int32Array]",zs="[object Uint8Array]",Hs="[object Uint8ClampedArray]",Vs="[object Uint16Array]",Ks="[object Uint32Array]",Hl=/\b__p \+= '';/g,Vl=/\b(__p \+=) '' \+/g,Kl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Xo=/&(?:amp|lt|gt|quot|#39);/g,ea=/[&<>"']/g,Fl=RegExp(Xo.source),Wl=RegExp(ea.source),Bl=/<%-([\s\S]+?)%>/g,Gl=/<%([\s\S]+?)%>/g,ta=/<%=([\s\S]+?)%>/g,Ql=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jl=/^\w*$/,Yl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fs=/[\\^$.*+?()[\]{}|]/g,Zl=RegExp(Fs.source),Ws=/^\s+/,Xl=/\s/,ep=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,tp=/\{\n\/\* \[wrapped with (.+)\] \*/,rp=/,? & /,ip=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sp=/[()=,{}\[\]\/\s]/,np=/\\(\\)?/g,op=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ra=/\w*$/,ap=/^[-+]0x[0-9a-f]+$/i,cp=/^0b[01]+$/i,up=/^\[object .+?Constructor\]$/,hp=/^0o[0-7]+$/i,lp=/^(?:0|[1-9]\d*)$/,pp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ti=/($^)/,dp=/['\n\r\u2028\u2029\\]/g,Ai="\\ud800-\\udfff",fp="\\u0300-\\u036f",gp="\\ufe20-\\ufe2f",yp="\\u20d0-\\u20ff",ia=fp+gp+yp,sa="\\u2700-\\u27bf",na="a-z\\xdf-\\xf6\\xf8-\\xff",vp="\\xac\\xb1\\xd7\\xf7",mp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wp="\\u2000-\\u206f",_p=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",oa="A-Z\\xc0-\\xd6\\xd8-\\xde",aa="\\ufe0e\\ufe0f",ca=vp+mp+wp+_p,Bs="['’]",bp="["+Ai+"]",ua="["+ca+"]",xi="["+ia+"]",ha="\\d+",Ep="["+sa+"]",la="["+na+"]",pa="[^"+Ai+ca+ha+sa+na+oa+"]",Gs="\\ud83c[\\udffb-\\udfff]",Ip="(?:"+xi+"|"+Gs+")",da="[^"+Ai+"]",Qs="(?:\\ud83c[\\udde6-\\uddff]){2}",Js="[\\ud800-\\udbff][\\udc00-\\udfff]",mr="["+oa+"]",fa="\\u200d",ga="(?:"+la+"|"+pa+")",Pp="(?:"+mr+"|"+pa+")",ya="(?:"+Bs+"(?:d|ll|m|re|s|t|ve))?",va="(?:"+Bs+"(?:D|LL|M|RE|S|T|VE))?",ma=Ip+"?",wa="["+aa+"]?",Sp="(?:"+fa+"(?:"+[da,Qs,Js].join("|")+")"+wa+ma+")*",Op="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",_a=wa+ma+Sp,Np="(?:"+[Ep,Qs,Js].join("|")+")"+_a,$p="(?:"+[da+xi+"?",xi,Qs,Js,bp].join("|")+")",Cp=RegExp(Bs,"g"),Tp=RegExp(xi,"g"),Ys=RegExp(Gs+"(?="+Gs+")|"+$p+_a,"g"),Ap=RegExp([mr+"?"+la+"+"+ya+"(?="+[ua,mr,"$"].join("|")+")",Pp+"+"+va+"(?="+[ua,mr+ga,"$"].join("|")+")",mr+"?"+ga+"+"+ya,mr+"+"+va,Rp,Op,ha,Np].join("|"),"g"),xp=RegExp("["+fa+Ai+ia+aa+"]"),Dp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,qp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],jp=-1,oe={};oe[js]=oe[Us]=oe[Ms]=oe[Ls]=oe[ks]=oe[zs]=oe[Hs]=oe[Vs]=oe[Ks]=!0,oe[yr]=oe[Ri]=oe[Qr]=oe[Vr]=oe[vr]=oe[Kr]=oe[Ni]=oe[$i]=oe[ot]=oe[Fr]=oe[Et]=oe[Wr]=oe[at]=oe[Br]=oe[Gr]=!1;var ie={};ie[yr]=ie[Ri]=ie[Qr]=ie[vr]=ie[Vr]=ie[Kr]=ie[js]=ie[Us]=ie[Ms]=ie[Ls]=ie[ks]=ie[ot]=ie[Fr]=ie[Et]=ie[Wr]=ie[at]=ie[Br]=ie[Ci]=ie[zs]=ie[Hs]=ie[Vs]=ie[Ks]=!0,ie[Ni]=ie[$i]=ie[Gr]=!1;var Up={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Mp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Lp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},kp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},zp=parseFloat,Hp=parseInt,ba=typeof vi=="object"&&vi&&vi.Object===Object&&vi,Vp=typeof self=="object"&&self&&self.Object===Object&&self,Ee=ba||Vp||Function("return this")(),Zs=t&&!t.nodeType&&t,Xt=Zs&&!0&&o&&!o.nodeType&&o,Ea=Xt&&Xt.exports===Zs,Xs=Ea&&ba.process,Je=function(){try{var v=Xt&&Xt.require&&Xt.require("util").types;return v||Xs&&Xs.binding&&Xs.binding("util")}catch{}}(),Ia=Je&&Je.isArrayBuffer,Pa=Je&&Je.isDate,Sa=Je&&Je.isMap,Oa=Je&&Je.isRegExp,Ra=Je&&Je.isSet,Na=Je&&Je.isTypedArray;function He(v,E,_){switch(_.length){case 0:return v.call(E);case 1:return v.call(E,_[0]);case 2:return v.call(E,_[0],_[1]);case 3:return v.call(E,_[0],_[1],_[2])}return v.apply(E,_)}function Kp(v,E,_,T){for(var k=-1,Z=v==null?0:v.length;++k<Z;){var me=v[k];E(T,me,_(me),v)}return T}function Ye(v,E){for(var _=-1,T=v==null?0:v.length;++_<T&&E(v[_],_,v)!==!1;);return v}function Fp(v,E){for(var _=v==null?0:v.length;_--&&E(v[_],_,v)!==!1;);return v}function $a(v,E){for(var _=-1,T=v==null?0:v.length;++_<T;)if(!E(v[_],_,v))return!1;return!0}function Mt(v,E){for(var _=-1,T=v==null?0:v.length,k=0,Z=[];++_<T;){var me=v[_];E(me,_,v)&&(Z[k++]=me)}return Z}function Di(v,E){var _=v==null?0:v.length;return!!_&&wr(v,E,0)>-1}function en(v,E,_){for(var T=-1,k=v==null?0:v.length;++T<k;)if(_(E,v[T]))return!0;return!1}function ce(v,E){for(var _=-1,T=v==null?0:v.length,k=Array(T);++_<T;)k[_]=E(v[_],_,v);return k}function Lt(v,E){for(var _=-1,T=E.length,k=v.length;++_<T;)v[k+_]=E[_];return v}function tn(v,E,_,T){var k=-1,Z=v==null?0:v.length;for(T&&Z&&(_=v[++k]);++k<Z;)_=E(_,v[k],k,v);return _}function Wp(v,E,_,T){var k=v==null?0:v.length;for(T&&k&&(_=v[--k]);k--;)_=E(_,v[k],k,v);return _}function rn(v,E){for(var _=-1,T=v==null?0:v.length;++_<T;)if(E(v[_],_,v))return!0;return!1}var Bp=sn("length");function Gp(v){return v.split("")}function Qp(v){return v.match(ip)||[]}function Ca(v,E,_){var T;return _(v,function(k,Z,me){if(E(k,Z,me))return T=Z,!1}),T}function qi(v,E,_,T){for(var k=v.length,Z=_+(T?1:-1);T?Z--:++Z<k;)if(E(v[Z],Z,v))return Z;return-1}function wr(v,E,_){return E===E?ad(v,E,_):qi(v,Ta,_)}function Jp(v,E,_,T){for(var k=_-1,Z=v.length;++k<Z;)if(T(v[k],E))return k;return-1}function Ta(v){return v!==v}function Aa(v,E){var _=v==null?0:v.length;return _?on(v,E)/_:Oi}function sn(v){return function(E){return E==null?r:E[v]}}function nn(v){return function(E){return v==null?r:v[E]}}function xa(v,E,_,T,k){return k(v,function(Z,me,re){_=T?(T=!1,Z):E(_,Z,me,re)}),_}function Yp(v,E){var _=v.length;for(v.sort(E);_--;)v[_]=v[_].value;return v}function on(v,E){for(var _,T=-1,k=v.length;++T<k;){var Z=E(v[T]);Z!==r&&(_=_===r?Z:_+Z)}return _}function an(v,E){for(var _=-1,T=Array(v);++_<v;)T[_]=E(_);return T}function Zp(v,E){return ce(E,function(_){return[_,v[_]]})}function Da(v){return v&&v.slice(0,Ma(v)+1).replace(Ws,"")}function Ve(v){return function(E){return v(E)}}function cn(v,E){return ce(E,function(_){return v[_]})}function Jr(v,E){return v.has(E)}function qa(v,E){for(var _=-1,T=v.length;++_<T&&wr(E,v[_],0)>-1;);return _}function ja(v,E){for(var _=v.length;_--&&wr(E,v[_],0)>-1;);return _}function Xp(v,E){for(var _=v.length,T=0;_--;)v[_]===E&&++T;return T}var ed=nn(Up),td=nn(Mp);function rd(v){return"\\"+kp[v]}function id(v,E){return v==null?r:v[E]}function _r(v){return xp.test(v)}function sd(v){return Dp.test(v)}function nd(v){for(var E,_=[];!(E=v.next()).done;)_.push(E.value);return _}function un(v){var E=-1,_=Array(v.size);return v.forEach(function(T,k){_[++E]=[k,T]}),_}function Ua(v,E){return function(_){return v(E(_))}}function kt(v,E){for(var _=-1,T=v.length,k=0,Z=[];++_<T;){var me=v[_];(me===E||me===N)&&(v[_]=N,Z[k++]=_)}return Z}function ji(v){var E=-1,_=Array(v.size);return v.forEach(function(T){_[++E]=T}),_}function od(v){var E=-1,_=Array(v.size);return v.forEach(function(T){_[++E]=[T,T]}),_}function ad(v,E,_){for(var T=_-1,k=v.length;++T<k;)if(v[T]===E)return T;return-1}function cd(v,E,_){for(var T=_+1;T--;)if(v[T]===E)return T;return T}function br(v){return _r(v)?hd(v):Bp(v)}function ct(v){return _r(v)?ld(v):Gp(v)}function Ma(v){for(var E=v.length;E--&&Xl.test(v.charAt(E)););return E}var ud=nn(Lp);function hd(v){for(var E=Ys.lastIndex=0;Ys.test(v);)++E;return E}function ld(v){return v.match(Ys)||[]}function pd(v){return v.match(Ap)||[]}var dd=function v(E){E=E==null?Ee:Er.defaults(Ee.Object(),E,Er.pick(Ee,qp));var _=E.Array,T=E.Date,k=E.Error,Z=E.Function,me=E.Math,re=E.Object,hn=E.RegExp,fd=E.String,Ze=E.TypeError,Ui=_.prototype,gd=Z.prototype,Ir=re.prototype,Mi=E["__core-js_shared__"],Li=gd.toString,ee=Ir.hasOwnProperty,yd=0,La=function(){var e=/[^.]+$/.exec(Mi&&Mi.keys&&Mi.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ki=Ir.toString,vd=Li.call(re),md=Ee._,wd=hn("^"+Li.call(ee).replace(Fs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zi=Ea?E.Buffer:r,zt=E.Symbol,Hi=E.Uint8Array,ka=zi?zi.allocUnsafe:r,Vi=Ua(re.getPrototypeOf,re),za=re.create,Ha=Ir.propertyIsEnumerable,Ki=Ui.splice,Va=zt?zt.isConcatSpreadable:r,Yr=zt?zt.iterator:r,er=zt?zt.toStringTag:r,Fi=function(){try{var e=nr(re,"defineProperty");return e({},"",{}),e}catch{}}(),_d=E.clearTimeout!==Ee.clearTimeout&&E.clearTimeout,bd=T&&T.now!==Ee.Date.now&&T.now,Ed=E.setTimeout!==Ee.setTimeout&&E.setTimeout,Wi=me.ceil,Bi=me.floor,ln=re.getOwnPropertySymbols,Id=zi?zi.isBuffer:r,Ka=E.isFinite,Pd=Ui.join,Sd=Ua(re.keys,re),we=me.max,Se=me.min,Od=T.now,Rd=E.parseInt,Fa=me.random,Nd=Ui.reverse,pn=nr(E,"DataView"),Zr=nr(E,"Map"),dn=nr(E,"Promise"),Pr=nr(E,"Set"),Xr=nr(E,"WeakMap"),ei=nr(re,"create"),Gi=Xr&&new Xr,Sr={},$d=or(pn),Cd=or(Zr),Td=or(dn),Ad=or(Pr),xd=or(Xr),Qi=zt?zt.prototype:r,ti=Qi?Qi.valueOf:r,Wa=Qi?Qi.toString:r;function p(e){if(le(e)&&!z(e)&&!(e instanceof G)){if(e instanceof Xe)return e;if(ee.call(e,"__wrapped__"))return Bc(e)}return new Xe(e)}var Or=function(){function e(){}return function(i){if(!he(i))return{};if(za)return za(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Ji(){}function Xe(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:Bl,evaluate:Gl,interpolate:ta,variable:"",imports:{_:p}},p.prototype=Ji.prototype,p.prototype.constructor=p,Xe.prototype=Or(Ji.prototype),Xe.prototype.constructor=Xe;function G(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=yt,this.__views__=[]}function Dd(){var e=new G(this.__wrapped__);return e.__actions__=De(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=De(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=De(this.__views__),e}function qd(){if(this.__filtered__){var e=new G(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function jd(){var e=this.__wrapped__.value(),i=this.__dir__,n=z(e),c=i<0,h=n?e.length:0,d=Qf(0,h,this.__views__),f=d.start,y=d.end,m=y-f,I=c?y:f-1,P=this.__iteratees__,O=P.length,C=0,D=Se(m,this.__takeCount__);if(!n||!c&&h==m&&D==m)return yc(e,this.__actions__);var M=[];e:for(;m--&&C<D;){I+=i;for(var V=-1,L=e[I];++V<O;){var W=P[V],Q=W.iteratee,We=W.type,Ae=Q(L);if(We==Cl)L=Ae;else if(!Ae){if(We==Jo)continue e;break e}}M[C++]=L}return M}G.prototype=Or(Ji.prototype),G.prototype.constructor=G;function tr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Ud(){this.__data__=ei?ei(null):{},this.size=0}function Md(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Ld(e){var i=this.__data__;if(ei){var n=i[e];return n===w?r:n}return ee.call(i,e)?i[e]:r}function kd(e){var i=this.__data__;return ei?i[e]!==r:ee.call(i,e)}function zd(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ei&&i===r?w:i,this}tr.prototype.clear=Ud,tr.prototype.delete=Md,tr.prototype.get=Ld,tr.prototype.has=kd,tr.prototype.set=zd;function It(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Hd(){this.__data__=[],this.size=0}function Vd(e){var i=this.__data__,n=Yi(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Ki.call(i,n,1),--this.size,!0}function Kd(e){var i=this.__data__,n=Yi(i,e);return n<0?r:i[n][1]}function Fd(e){return Yi(this.__data__,e)>-1}function Wd(e,i){var n=this.__data__,c=Yi(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}It.prototype.clear=Hd,It.prototype.delete=Vd,It.prototype.get=Kd,It.prototype.has=Fd,It.prototype.set=Wd;function Pt(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Bd(){this.size=0,this.__data__={hash:new tr,map:new(Zr||It),string:new tr}}function Gd(e){var i=us(this,e).delete(e);return this.size-=i?1:0,i}function Qd(e){return us(this,e).get(e)}function Jd(e){return us(this,e).has(e)}function Yd(e,i){var n=us(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}Pt.prototype.clear=Bd,Pt.prototype.delete=Gd,Pt.prototype.get=Qd,Pt.prototype.has=Jd,Pt.prototype.set=Yd;function rr(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new Pt;++i<n;)this.add(e[i])}function Zd(e){return this.__data__.set(e,w),this}function Xd(e){return this.__data__.has(e)}rr.prototype.add=rr.prototype.push=Zd,rr.prototype.has=Xd;function ut(e){var i=this.__data__=new It(e);this.size=i.size}function ef(){this.__data__=new It,this.size=0}function tf(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function rf(e){return this.__data__.get(e)}function sf(e){return this.__data__.has(e)}function nf(e,i){var n=this.__data__;if(n instanceof It){var c=n.__data__;if(!Zr||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new Pt(c)}return n.set(e,i),this.size=n.size,this}ut.prototype.clear=ef,ut.prototype.delete=tf,ut.prototype.get=rf,ut.prototype.has=sf,ut.prototype.set=nf;function Ba(e,i){var n=z(e),c=!n&&ar(e),h=!n&&!c&&Wt(e),d=!n&&!c&&!h&&Cr(e),f=n||c||h||d,y=f?an(e.length,fd):[],m=y.length;for(var I in e)(i||ee.call(e,I))&&!(f&&(I=="length"||h&&(I=="offset"||I=="parent")||d&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Nt(I,m)))&&y.push(I);return y}function Ga(e){var i=e.length;return i?e[Pn(0,i-1)]:r}function of(e,i){return hs(De(e),ir(i,0,e.length))}function af(e){return hs(De(e))}function fn(e,i,n){(n!==r&&!ht(e[i],n)||n===r&&!(i in e))&&St(e,i,n)}function ri(e,i,n){var c=e[i];(!(ee.call(e,i)&&ht(c,n))||n===r&&!(i in e))&&St(e,i,n)}function Yi(e,i){for(var n=e.length;n--;)if(ht(e[n][0],i))return n;return-1}function cf(e,i,n,c){return Ht(e,function(h,d,f){i(c,h,n(h),f)}),c}function Qa(e,i){return e&&mt(i,_e(i),e)}function uf(e,i){return e&&mt(i,je(i),e)}function St(e,i,n){i=="__proto__"&&Fi?Fi(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function gn(e,i){for(var n=-1,c=i.length,h=_(c),d=e==null;++n<c;)h[n]=d?r:Qn(e,i[n]);return h}function ir(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function et(e,i,n,c,h,d){var f,y=i&S,m=i&R,I=i&j;if(n&&(f=h?n(e,c,h,d):n(e)),f!==r)return f;if(!he(e))return e;var P=z(e);if(P){if(f=Yf(e),!y)return De(e,f)}else{var O=Oe(e),C=O==$i||O==Yo;if(Wt(e))return wc(e,y);if(O==Et||O==yr||C&&!h){if(f=m||C?{}:Mc(e),!y)return m?kf(e,uf(f,e)):Lf(e,Qa(f,e))}else{if(!ie[O])return h?e:{};f=Zf(e,O,y)}}d||(d=new ut);var D=d.get(e);if(D)return D;d.set(e,f),du(e)?e.forEach(function(L){f.add(et(L,i,n,L,e,d))}):lu(e)&&e.forEach(function(L,W){f.set(W,et(L,i,n,W,e,d))});var M=I?m?qn:Dn:m?je:_e,V=P?r:M(e);return Ye(V||e,function(L,W){V&&(W=L,L=e[W]),ri(f,W,et(L,i,n,W,e,d))}),f}function hf(e){var i=_e(e);return function(n){return Ja(n,e,i)}}function Ja(e,i,n){var c=n.length;if(e==null)return!c;for(e=re(e);c--;){var h=n[c],d=i[h],f=e[h];if(f===r&&!(h in e)||!d(f))return!1}return!0}function Ya(e,i,n){if(typeof e!="function")throw new Ze(l);return ui(function(){e.apply(r,n)},i)}function ii(e,i,n,c){var h=-1,d=Di,f=!0,y=e.length,m=[],I=i.length;if(!y)return m;n&&(i=ce(i,Ve(n))),c?(d=en,f=!1):i.length>=a&&(d=Jr,f=!1,i=new rr(i));e:for(;++h<y;){var P=e[h],O=n==null?P:n(P);if(P=c||P!==0?P:0,f&&O===O){for(var C=I;C--;)if(i[C]===O)continue e;m.push(P)}else d(i,O,c)||m.push(P)}return m}var Ht=Pc(vt),Za=Pc(vn,!0);function lf(e,i){var n=!0;return Ht(e,function(c,h,d){return n=!!i(c,h,d),n}),n}function Zi(e,i,n){for(var c=-1,h=e.length;++c<h;){var d=e[c],f=i(d);if(f!=null&&(y===r?f===f&&!Fe(f):n(f,y)))var y=f,m=d}return m}function pf(e,i,n,c){var h=e.length;for(n=H(n),n<0&&(n=-n>h?0:h+n),c=c===r||c>h?h:H(c),c<0&&(c+=h),c=n>c?0:gu(c);n<c;)e[n++]=i;return e}function Xa(e,i){var n=[];return Ht(e,function(c,h,d){i(c,h,d)&&n.push(c)}),n}function Ie(e,i,n,c,h){var d=-1,f=e.length;for(n||(n=eg),h||(h=[]);++d<f;){var y=e[d];i>0&&n(y)?i>1?Ie(y,i-1,n,c,h):Lt(h,y):c||(h[h.length]=y)}return h}var yn=Sc(),ec=Sc(!0);function vt(e,i){return e&&yn(e,i,_e)}function vn(e,i){return e&&ec(e,i,_e)}function Xi(e,i){return Mt(i,function(n){return $t(e[n])})}function sr(e,i){i=Kt(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[wt(i[n++])];return n&&n==c?e:r}function tc(e,i,n){var c=i(e);return z(e)?c:Lt(c,n(e))}function Ce(e){return e==null?e===r?kl:Ml:er&&er in re(e)?Gf(e):ag(e)}function mn(e,i){return e>i}function df(e,i){return e!=null&&ee.call(e,i)}function ff(e,i){return e!=null&&i in re(e)}function gf(e,i,n){return e>=Se(i,n)&&e<we(i,n)}function wn(e,i,n){for(var c=n?en:Di,h=e[0].length,d=e.length,f=d,y=_(d),m=1/0,I=[];f--;){var P=e[f];f&&i&&(P=ce(P,Ve(i))),m=Se(P.length,m),y[f]=!n&&(i||h>=120&&P.length>=120)?new rr(f&&P):r}P=e[0];var O=-1,C=y[0];e:for(;++O<h&&I.length<m;){var D=P[O],M=i?i(D):D;if(D=n||D!==0?D:0,!(C?Jr(C,M):c(I,M,n))){for(f=d;--f;){var V=y[f];if(!(V?Jr(V,M):c(e[f],M,n)))continue e}C&&C.push(M),I.push(D)}}return I}function yf(e,i,n,c){return vt(e,function(h,d,f){i(c,n(h),d,f)}),c}function si(e,i,n){i=Kt(i,e),e=Hc(e,i);var c=e==null?e:e[wt(rt(i))];return c==null?r:He(c,e,n)}function rc(e){return le(e)&&Ce(e)==yr}function vf(e){return le(e)&&Ce(e)==Qr}function mf(e){return le(e)&&Ce(e)==Kr}function ni(e,i,n,c,h){return e===i?!0:e==null||i==null||!le(e)&&!le(i)?e!==e&&i!==i:wf(e,i,n,c,ni,h)}function wf(e,i,n,c,h,d){var f=z(e),y=z(i),m=f?Ri:Oe(e),I=y?Ri:Oe(i);m=m==yr?Et:m,I=I==yr?Et:I;var P=m==Et,O=I==Et,C=m==I;if(C&&Wt(e)){if(!Wt(i))return!1;f=!0,P=!1}if(C&&!P)return d||(d=new ut),f||Cr(e)?qc(e,i,n,c,h,d):Wf(e,i,m,n,c,h,d);if(!(n&A)){var D=P&&ee.call(e,"__wrapped__"),M=O&&ee.call(i,"__wrapped__");if(D||M){var V=D?e.value():e,L=M?i.value():i;return d||(d=new ut),h(V,L,n,c,d)}}return C?(d||(d=new ut),Bf(e,i,n,c,h,d)):!1}function _f(e){return le(e)&&Oe(e)==ot}function _n(e,i,n,c){var h=n.length,d=h,f=!c;if(e==null)return!d;for(e=re(e);h--;){var y=n[h];if(f&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++h<d;){y=n[h];var m=y[0],I=e[m],P=y[1];if(f&&y[2]){if(I===r&&!(m in e))return!1}else{var O=new ut;if(c)var C=c(I,P,m,e,i,O);if(!(C===r?ni(P,I,A|K,c,O):C))return!1}}return!0}function ic(e){if(!he(e)||rg(e))return!1;var i=$t(e)?wd:up;return i.test(or(e))}function bf(e){return le(e)&&Ce(e)==Wr}function Ef(e){return le(e)&&Oe(e)==at}function If(e){return le(e)&&ys(e.length)&&!!oe[Ce(e)]}function sc(e){return typeof e=="function"?e:e==null?Ue:typeof e=="object"?z(e)?ac(e[0],e[1]):oc(e):Ou(e)}function bn(e){if(!ci(e))return Sd(e);var i=[];for(var n in re(e))ee.call(e,n)&&n!="constructor"&&i.push(n);return i}function Pf(e){if(!he(e))return og(e);var i=ci(e),n=[];for(var c in e)c=="constructor"&&(i||!ee.call(e,c))||n.push(c);return n}function En(e,i){return e<i}function nc(e,i){var n=-1,c=qe(e)?_(e.length):[];return Ht(e,function(h,d,f){c[++n]=i(h,d,f)}),c}function oc(e){var i=Un(e);return i.length==1&&i[0][2]?kc(i[0][0],i[0][1]):function(n){return n===e||_n(n,e,i)}}function ac(e,i){return Ln(e)&&Lc(i)?kc(wt(e),i):function(n){var c=Qn(n,e);return c===r&&c===i?Jn(n,e):ni(i,c,A|K)}}function es(e,i,n,c,h){e!==i&&yn(i,function(d,f){if(h||(h=new ut),he(d))Sf(e,i,f,n,es,c,h);else{var y=c?c(zn(e,f),d,f+"",e,i,h):r;y===r&&(y=d),fn(e,f,y)}},je)}function Sf(e,i,n,c,h,d,f){var y=zn(e,n),m=zn(i,n),I=f.get(m);if(I){fn(e,n,I);return}var P=d?d(y,m,n+"",e,i,f):r,O=P===r;if(O){var C=z(m),D=!C&&Wt(m),M=!C&&!D&&Cr(m);P=m,C||D||M?z(y)?P=y:fe(y)?P=De(y):D?(O=!1,P=wc(m,!0)):M?(O=!1,P=_c(m,!0)):P=[]:hi(m)||ar(m)?(P=y,ar(y)?P=yu(y):(!he(y)||$t(y))&&(P=Mc(m))):O=!1}O&&(f.set(m,P),h(P,m,c,d,f),f.delete(m)),fn(e,n,P)}function cc(e,i){var n=e.length;if(n)return i+=i<0?n:0,Nt(i,n)?e[i]:r}function uc(e,i,n){i.length?i=ce(i,function(d){return z(d)?function(f){return sr(f,d.length===1?d[0]:d)}:d}):i=[Ue];var c=-1;i=ce(i,Ve(U()));var h=nc(e,function(d,f,y){var m=ce(i,function(I){return I(d)});return{criteria:m,index:++c,value:d}});return Yp(h,function(d,f){return Mf(d,f,n)})}function Of(e,i){return hc(e,i,function(n,c){return Jn(e,c)})}function hc(e,i,n){for(var c=-1,h=i.length,d={};++c<h;){var f=i[c],y=sr(e,f);n(y,f)&&oi(d,Kt(f,e),y)}return d}function Rf(e){return function(i){return sr(i,e)}}function In(e,i,n,c){var h=c?Jp:wr,d=-1,f=i.length,y=e;for(e===i&&(i=De(i)),n&&(y=ce(e,Ve(n)));++d<f;)for(var m=0,I=i[d],P=n?n(I):I;(m=h(y,P,m,c))>-1;)y!==e&&Ki.call(y,m,1),Ki.call(e,m,1);return e}function lc(e,i){for(var n=e?i.length:0,c=n-1;n--;){var h=i[n];if(n==c||h!==d){var d=h;Nt(h)?Ki.call(e,h,1):Rn(e,h)}}return e}function Pn(e,i){return e+Bi(Fa()*(i-e+1))}function Nf(e,i,n,c){for(var h=-1,d=we(Wi((i-e)/(n||1)),0),f=_(d);d--;)f[c?d:++h]=e,e+=n;return f}function Sn(e,i){var n="";if(!e||i<1||i>Ut)return n;do i%2&&(n+=e),i=Bi(i/2),i&&(e+=e);while(i);return n}function F(e,i){return Hn(zc(e,i,Ue),e+"")}function $f(e){return Ga(Tr(e))}function Cf(e,i){var n=Tr(e);return hs(n,ir(i,0,n.length))}function oi(e,i,n,c){if(!he(e))return e;i=Kt(i,e);for(var h=-1,d=i.length,f=d-1,y=e;y!=null&&++h<d;){var m=wt(i[h]),I=n;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(h!=f){var P=y[m];I=c?c(P,m,y):r,I===r&&(I=he(P)?P:Nt(i[h+1])?[]:{})}ri(y,m,I),y=y[m]}return e}var pc=Gi?function(e,i){return Gi.set(e,i),e}:Ue,Tf=Fi?function(e,i){return Fi(e,"toString",{configurable:!0,enumerable:!1,value:Zn(i),writable:!0})}:Ue;function Af(e){return hs(Tr(e))}function tt(e,i,n){var c=-1,h=e.length;i<0&&(i=-i>h?0:h+i),n=n>h?h:n,n<0&&(n+=h),h=i>n?0:n-i>>>0,i>>>=0;for(var d=_(h);++c<h;)d[c]=e[c+i];return d}function xf(e,i){var n;return Ht(e,function(c,h,d){return n=i(c,h,d),!n}),!!n}function ts(e,i,n){var c=0,h=e==null?c:e.length;if(typeof i=="number"&&i===i&&h<=Dl){for(;c<h;){var d=c+h>>>1,f=e[d];f!==null&&!Fe(f)&&(n?f<=i:f<i)?c=d+1:h=d}return h}return On(e,i,Ue,n)}function On(e,i,n,c){var h=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var f=i!==i,y=i===null,m=Fe(i),I=i===r;h<d;){var P=Bi((h+d)/2),O=n(e[P]),C=O!==r,D=O===null,M=O===O,V=Fe(O);if(f)var L=c||M;else I?L=M&&(c||C):y?L=M&&C&&(c||!D):m?L=M&&C&&!D&&(c||!V):D||V?L=!1:L=c?O<=i:O<i;L?h=P+1:d=P}return Se(d,xl)}function dc(e,i){for(var n=-1,c=e.length,h=0,d=[];++n<c;){var f=e[n],y=i?i(f):f;if(!n||!ht(y,m)){var m=y;d[h++]=f===0?0:f}}return d}function fc(e){return typeof e=="number"?e:Fe(e)?Oi:+e}function Ke(e){if(typeof e=="string")return e;if(z(e))return ce(e,Ke)+"";if(Fe(e))return Wa?Wa.call(e):"";var i=e+"";return i=="0"&&1/e==-Zt?"-0":i}function Vt(e,i,n){var c=-1,h=Di,d=e.length,f=!0,y=[],m=y;if(n)f=!1,h=en;else if(d>=a){var I=i?null:Kf(e);if(I)return ji(I);f=!1,h=Jr,m=new rr}else m=i?[]:y;e:for(;++c<d;){var P=e[c],O=i?i(P):P;if(P=n||P!==0?P:0,f&&O===O){for(var C=m.length;C--;)if(m[C]===O)continue e;i&&m.push(O),y.push(P)}else h(m,O,n)||(m!==y&&m.push(O),y.push(P))}return y}function Rn(e,i){return i=Kt(i,e),e=Hc(e,i),e==null||delete e[wt(rt(i))]}function gc(e,i,n,c){return oi(e,i,n(sr(e,i)),c)}function rs(e,i,n,c){for(var h=e.length,d=c?h:-1;(c?d--:++d<h)&&i(e[d],d,e););return n?tt(e,c?0:d,c?d+1:h):tt(e,c?d+1:0,c?h:d)}function yc(e,i){var n=e;return n instanceof G&&(n=n.value()),tn(i,function(c,h){return h.func.apply(h.thisArg,Lt([c],h.args))},n)}function Nn(e,i,n){var c=e.length;if(c<2)return c?Vt(e[0]):[];for(var h=-1,d=_(c);++h<c;)for(var f=e[h],y=-1;++y<c;)y!=h&&(d[h]=ii(d[h]||f,e[y],i,n));return Vt(Ie(d,1),i,n)}function vc(e,i,n){for(var c=-1,h=e.length,d=i.length,f={};++c<h;){var y=c<d?i[c]:r;n(f,e[c],y)}return f}function $n(e){return fe(e)?e:[]}function Cn(e){return typeof e=="function"?e:Ue}function Kt(e,i){return z(e)?e:Ln(e,i)?[e]:Wc(X(e))}var Df=F;function Ft(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:tt(e,i,n)}var mc=_d||function(e){return Ee.clearTimeout(e)};function wc(e,i){if(i)return e.slice();var n=e.length,c=ka?ka(n):new e.constructor(n);return e.copy(c),c}function Tn(e){var i=new e.constructor(e.byteLength);return new Hi(i).set(new Hi(e)),i}function qf(e,i){var n=i?Tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function jf(e){var i=new e.constructor(e.source,ra.exec(e));return i.lastIndex=e.lastIndex,i}function Uf(e){return ti?re(ti.call(e)):{}}function _c(e,i){var n=i?Tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function bc(e,i){if(e!==i){var n=e!==r,c=e===null,h=e===e,d=Fe(e),f=i!==r,y=i===null,m=i===i,I=Fe(i);if(!y&&!I&&!d&&e>i||d&&f&&m&&!y&&!I||c&&f&&m||!n&&m||!h)return 1;if(!c&&!d&&!I&&e<i||I&&n&&h&&!c&&!d||y&&n&&h||!f&&h||!m)return-1}return 0}function Mf(e,i,n){for(var c=-1,h=e.criteria,d=i.criteria,f=h.length,y=n.length;++c<f;){var m=bc(h[c],d[c]);if(m){if(c>=y)return m;var I=n[c];return m*(I=="desc"?-1:1)}}return e.index-i.index}function Ec(e,i,n,c){for(var h=-1,d=e.length,f=n.length,y=-1,m=i.length,I=we(d-f,0),P=_(m+I),O=!c;++y<m;)P[y]=i[y];for(;++h<f;)(O||h<d)&&(P[n[h]]=e[h]);for(;I--;)P[y++]=e[h++];return P}function Ic(e,i,n,c){for(var h=-1,d=e.length,f=-1,y=n.length,m=-1,I=i.length,P=we(d-y,0),O=_(P+I),C=!c;++h<P;)O[h]=e[h];for(var D=h;++m<I;)O[D+m]=i[m];for(;++f<y;)(C||h<d)&&(O[D+n[f]]=e[h++]);return O}function De(e,i){var n=-1,c=e.length;for(i||(i=_(c));++n<c;)i[n]=e[n];return i}function mt(e,i,n,c){var h=!n;n||(n={});for(var d=-1,f=i.length;++d<f;){var y=i[d],m=c?c(n[y],e[y],y,n,e):r;m===r&&(m=e[y]),h?St(n,y,m):ri(n,y,m)}return n}function Lf(e,i){return mt(e,Mn(e),i)}function kf(e,i){return mt(e,jc(e),i)}function is(e,i){return function(n,c){var h=z(n)?Kp:cf,d=i?i():{};return h(n,e,U(c,2),d)}}function Rr(e){return F(function(i,n){var c=-1,h=n.length,d=h>1?n[h-1]:r,f=h>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(h--,d):r,f&&Te(n[0],n[1],f)&&(d=h<3?r:d,h=1),i=re(i);++c<h;){var y=n[c];y&&e(i,y,c,d)}return i})}function Pc(e,i){return function(n,c){if(n==null)return n;if(!qe(n))return e(n,c);for(var h=n.length,d=i?h:-1,f=re(n);(i?d--:++d<h)&&c(f[d],d,f)!==!1;);return n}}function Sc(e){return function(i,n,c){for(var h=-1,d=re(i),f=c(i),y=f.length;y--;){var m=f[e?y:++h];if(n(d[m],m,d)===!1)break}return i}}function zf(e,i,n){var c=i&x,h=ai(e);function d(){var f=this&&this!==Ee&&this instanceof d?h:e;return f.apply(c?n:this,arguments)}return d}function Oc(e){return function(i){i=X(i);var n=_r(i)?ct(i):r,c=n?n[0]:i.charAt(0),h=n?Ft(n,1).join(""):i.slice(1);return c[e]()+h}}function Nr(e){return function(i){return tn(Pu(Iu(i).replace(Cp,"")),e,"")}}function ai(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=Or(e.prototype),c=e.apply(n,i);return he(c)?c:n}}function Hf(e,i,n){var c=ai(e);function h(){for(var d=arguments.length,f=_(d),y=d,m=$r(h);y--;)f[y]=arguments[y];var I=d<3&&f[0]!==m&&f[d-1]!==m?[]:kt(f,m);if(d-=I.length,d<n)return Tc(e,i,ss,h.placeholder,r,f,I,r,r,n-d);var P=this&&this!==Ee&&this instanceof h?c:e;return He(P,this,f)}return h}function Rc(e){return function(i,n,c){var h=re(i);if(!qe(i)){var d=U(n,3);i=_e(i),n=function(y){return d(h[y],y,h)}}var f=e(i,n,c);return f>-1?h[d?i[f]:f]:r}}function Nc(e){return Rt(function(i){var n=i.length,c=n,h=Xe.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new Ze(l);if(h&&!f&&cs(d)=="wrapper")var f=new Xe([],!0)}for(c=f?c:n;++c<n;){d=i[c];var y=cs(d),m=y=="wrapper"?jn(d):r;m&&kn(m[0])&&m[1]==(de|J|ae|$e)&&!m[4].length&&m[9]==1?f=f[cs(m[0])].apply(f,m[3]):f=d.length==1&&kn(d)?f[y]():f.thru(d)}return function(){var I=arguments,P=I[0];if(f&&I.length==1&&z(P))return f.plant(P).value();for(var O=0,C=n?i[O].apply(this,I):P;++O<n;)C=i[O].call(this,C);return C}})}function ss(e,i,n,c,h,d,f,y,m,I){var P=i&de,O=i&x,C=i&B,D=i&(J|Y),M=i&jt,V=C?r:ai(e);function L(){for(var W=arguments.length,Q=_(W),We=W;We--;)Q[We]=arguments[We];if(D)var Ae=$r(L),Be=Xp(Q,Ae);if(c&&(Q=Ec(Q,c,h,D)),d&&(Q=Ic(Q,d,f,D)),W-=Be,D&&W<I){var ge=kt(Q,Ae);return Tc(e,i,ss,L.placeholder,n,Q,ge,y,m,I-W)}var lt=O?n:this,Tt=C?lt[e]:e;return W=Q.length,y?Q=cg(Q,y):M&&W>1&&Q.reverse(),P&&m<W&&(Q.length=m),this&&this!==Ee&&this instanceof L&&(Tt=V||ai(Tt)),Tt.apply(lt,Q)}return L}function $c(e,i){return function(n,c){return yf(n,e,i(c),{})}}function ns(e,i){return function(n,c){var h;if(n===r&&c===r)return i;if(n!==r&&(h=n),c!==r){if(h===r)return c;typeof n=="string"||typeof c=="string"?(n=Ke(n),c=Ke(c)):(n=fc(n),c=fc(c)),h=e(n,c)}return h}}function An(e){return Rt(function(i){return i=ce(i,Ve(U())),F(function(n){var c=this;return e(i,function(h){return He(h,c,n)})})})}function os(e,i){i=i===r?" ":Ke(i);var n=i.length;if(n<2)return n?Sn(i,e):i;var c=Sn(i,Wi(e/br(i)));return _r(i)?Ft(ct(c),0,e).join(""):c.slice(0,e)}function Vf(e,i,n,c){var h=i&x,d=ai(e);function f(){for(var y=-1,m=arguments.length,I=-1,P=c.length,O=_(P+m),C=this&&this!==Ee&&this instanceof f?d:e;++I<P;)O[I]=c[I];for(;m--;)O[I++]=arguments[++y];return He(C,h?n:this,O)}return f}function Cc(e){return function(i,n,c){return c&&typeof c!="number"&&Te(i,n,c)&&(n=c=r),i=Ct(i),n===r?(n=i,i=0):n=Ct(n),c=c===r?i<n?1:-1:Ct(c),Nf(i,n,c,e)}}function as(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=it(i),n=it(n)),e(i,n)}}function Tc(e,i,n,c,h,d,f,y,m,I){var P=i&J,O=P?f:r,C=P?r:f,D=P?d:r,M=P?r:d;i|=P?ae:Ne,i&=~(P?Ne:ae),i&pe||(i&=~(x|B));var V=[e,i,h,D,O,M,C,y,m,I],L=n.apply(r,V);return kn(e)&&Vc(L,V),L.placeholder=c,Kc(L,e,i)}function xn(e){var i=me[e];return function(n,c){if(n=it(n),c=c==null?0:Se(H(c),292),c&&Ka(n)){var h=(X(n)+"e").split("e"),d=i(h[0]+"e"+(+h[1]+c));return h=(X(d)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return i(n)}}var Kf=Pr&&1/ji(new Pr([,-0]))[1]==Zt?function(e){return new Pr(e)}:to;function Ac(e){return function(i){var n=Oe(i);return n==ot?un(i):n==at?od(i):Zp(i,e(i))}}function Ot(e,i,n,c,h,d,f,y){var m=i&B;if(!m&&typeof e!="function")throw new Ze(l);var I=c?c.length:0;if(I||(i&=~(ae|Ne),c=h=r),f=f===r?f:we(H(f),0),y=y===r?y:H(y),I-=h?h.length:0,i&Ne){var P=c,O=h;c=h=r}var C=m?r:jn(e),D=[e,i,n,c,h,P,O,d,f,y];if(C&&ng(D,C),e=D[0],i=D[1],n=D[2],c=D[3],h=D[4],y=D[9]=D[9]===r?m?0:e.length:we(D[9]-I,0),!y&&i&(J|Y)&&(i&=~(J|Y)),!i||i==x)var M=zf(e,i,n);else i==J||i==Y?M=Hf(e,i,y):(i==ae||i==(x|ae))&&!h.length?M=Vf(e,i,n,c):M=ss.apply(r,D);var V=C?pc:Vc;return Kc(V(M,D),e,i)}function xc(e,i,n,c){return e===r||ht(e,Ir[n])&&!ee.call(c,n)?i:e}function Dc(e,i,n,c,h,d){return he(e)&&he(i)&&(d.set(i,e),es(e,i,r,Dc,d),d.delete(i)),e}function Ff(e){return hi(e)?r:e}function qc(e,i,n,c,h,d){var f=n&A,y=e.length,m=i.length;if(y!=m&&!(f&&m>y))return!1;var I=d.get(e),P=d.get(i);if(I&&P)return I==i&&P==e;var O=-1,C=!0,D=n&K?new rr:r;for(d.set(e,i),d.set(i,e);++O<y;){var M=e[O],V=i[O];if(c)var L=f?c(V,M,O,i,e,d):c(M,V,O,e,i,d);if(L!==r){if(L)continue;C=!1;break}if(D){if(!rn(i,function(W,Q){if(!Jr(D,Q)&&(M===W||h(M,W,n,c,d)))return D.push(Q)})){C=!1;break}}else if(!(M===V||h(M,V,n,c,d))){C=!1;break}}return d.delete(e),d.delete(i),C}function Wf(e,i,n,c,h,d,f){switch(n){case vr:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Qr:return!(e.byteLength!=i.byteLength||!d(new Hi(e),new Hi(i)));case Vr:case Kr:case Fr:return ht(+e,+i);case Ni:return e.name==i.name&&e.message==i.message;case Wr:case Br:return e==i+"";case ot:var y=un;case at:var m=c&A;if(y||(y=ji),e.size!=i.size&&!m)return!1;var I=f.get(e);if(I)return I==i;c|=K,f.set(e,i);var P=qc(y(e),y(i),c,h,d,f);return f.delete(e),P;case Ci:if(ti)return ti.call(e)==ti.call(i)}return!1}function Bf(e,i,n,c,h,d){var f=n&A,y=Dn(e),m=y.length,I=Dn(i),P=I.length;if(m!=P&&!f)return!1;for(var O=m;O--;){var C=y[O];if(!(f?C in i:ee.call(i,C)))return!1}var D=d.get(e),M=d.get(i);if(D&&M)return D==i&&M==e;var V=!0;d.set(e,i),d.set(i,e);for(var L=f;++O<m;){C=y[O];var W=e[C],Q=i[C];if(c)var We=f?c(Q,W,C,i,e,d):c(W,Q,C,e,i,d);if(!(We===r?W===Q||h(W,Q,n,c,d):We)){V=!1;break}L||(L=C=="constructor")}if(V&&!L){var Ae=e.constructor,Be=i.constructor;Ae!=Be&&"constructor"in e&&"constructor"in i&&!(typeof Ae=="function"&&Ae instanceof Ae&&typeof Be=="function"&&Be instanceof Be)&&(V=!1)}return d.delete(e),d.delete(i),V}function Rt(e){return Hn(zc(e,r,Jc),e+"")}function Dn(e){return tc(e,_e,Mn)}function qn(e){return tc(e,je,jc)}var jn=Gi?function(e){return Gi.get(e)}:to;function cs(e){for(var i=e.name+"",n=Sr[i],c=ee.call(Sr,i)?n.length:0;c--;){var h=n[c],d=h.func;if(d==null||d==e)return h.name}return i}function $r(e){var i=ee.call(p,"placeholder")?p:e;return i.placeholder}function U(){var e=p.iteratee||Xn;return e=e===Xn?sc:e,arguments.length?e(arguments[0],arguments[1]):e}function us(e,i){var n=e.__data__;return tg(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Un(e){for(var i=_e(e),n=i.length;n--;){var c=i[n],h=e[c];i[n]=[c,h,Lc(h)]}return i}function nr(e,i){var n=id(e,i);return ic(n)?n:r}function Gf(e){var i=ee.call(e,er),n=e[er];try{e[er]=r;var c=!0}catch{}var h=ki.call(e);return c&&(i?e[er]=n:delete e[er]),h}var Mn=ln?function(e){return e==null?[]:(e=re(e),Mt(ln(e),function(i){return Ha.call(e,i)}))}:ro,jc=ln?function(e){for(var i=[];e;)Lt(i,Mn(e)),e=Vi(e);return i}:ro,Oe=Ce;(pn&&Oe(new pn(new ArrayBuffer(1)))!=vr||Zr&&Oe(new Zr)!=ot||dn&&Oe(dn.resolve())!=Zo||Pr&&Oe(new Pr)!=at||Xr&&Oe(new Xr)!=Gr)&&(Oe=function(e){var i=Ce(e),n=i==Et?e.constructor:r,c=n?or(n):"";if(c)switch(c){case $d:return vr;case Cd:return ot;case Td:return Zo;case Ad:return at;case xd:return Gr}return i});function Qf(e,i,n){for(var c=-1,h=n.length;++c<h;){var d=n[c],f=d.size;switch(d.type){case"drop":e+=f;break;case"dropRight":i-=f;break;case"take":i=Se(i,e+f);break;case"takeRight":e=we(e,i-f);break}}return{start:e,end:i}}function Jf(e){var i=e.match(tp);return i?i[1].split(rp):[]}function Uc(e,i,n){i=Kt(i,e);for(var c=-1,h=i.length,d=!1;++c<h;){var f=wt(i[c]);if(!(d=e!=null&&n(e,f)))break;e=e[f]}return d||++c!=h?d:(h=e==null?0:e.length,!!h&&ys(h)&&Nt(f,h)&&(z(e)||ar(e)))}function Yf(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&ee.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Mc(e){return typeof e.constructor=="function"&&!ci(e)?Or(Vi(e)):{}}function Zf(e,i,n){var c=e.constructor;switch(i){case Qr:return Tn(e);case Vr:case Kr:return new c(+e);case vr:return qf(e,n);case js:case Us:case Ms:case Ls:case ks:case zs:case Hs:case Vs:case Ks:return _c(e,n);case ot:return new c;case Fr:case Br:return new c(e);case Wr:return jf(e);case at:return new c;case Ci:return Uf(e)}}function Xf(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(ep,`{
/* [wrapped with `+i+`] */
`)}function eg(e){return z(e)||ar(e)||!!(Va&&e&&e[Va])}function Nt(e,i){var n=typeof e;return i=i??Ut,!!i&&(n=="number"||n!="symbol"&&lp.test(e))&&e>-1&&e%1==0&&e<i}function Te(e,i,n){if(!he(n))return!1;var c=typeof i;return(c=="number"?qe(n)&&Nt(i,n.length):c=="string"&&i in n)?ht(n[i],e):!1}function Ln(e,i){if(z(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Fe(e)?!0:Jl.test(e)||!Ql.test(e)||i!=null&&e in re(i)}function tg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function kn(e){var i=cs(e),n=p[i];if(typeof n!="function"||!(i in G.prototype))return!1;if(e===n)return!0;var c=jn(n);return!!c&&e===c[0]}function rg(e){return!!La&&La in e}var ig=Mi?$t:io;function ci(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||Ir;return e===n}function Lc(e){return e===e&&!he(e)}function kc(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in re(n))}}function sg(e){var i=fs(e,function(c){return n.size===b&&n.clear(),c}),n=i.cache;return i}function ng(e,i){var n=e[1],c=i[1],h=n|c,d=h<(x|B|de),f=c==de&&n==J||c==de&&n==$e&&e[7].length<=i[8]||c==(de|$e)&&i[7].length<=i[8]&&n==J;if(!(d||f))return e;c&x&&(e[2]=i[2],h|=n&x?0:pe);var y=i[3];if(y){var m=e[3];e[3]=m?Ec(m,y,i[4]):y,e[4]=m?kt(e[3],N):i[4]}return y=i[5],y&&(m=e[5],e[5]=m?Ic(m,y,i[6]):y,e[6]=m?kt(e[5],N):i[6]),y=i[7],y&&(e[7]=y),c&de&&(e[8]=e[8]==null?i[8]:Se(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=h,e}function og(e){var i=[];if(e!=null)for(var n in re(e))i.push(n);return i}function ag(e){return ki.call(e)}function zc(e,i,n){return i=we(i===r?e.length-1:i,0),function(){for(var c=arguments,h=-1,d=we(c.length-i,0),f=_(d);++h<d;)f[h]=c[i+h];h=-1;for(var y=_(i+1);++h<i;)y[h]=c[h];return y[i]=n(f),He(e,this,y)}}function Hc(e,i){return i.length<2?e:sr(e,tt(i,0,-1))}function cg(e,i){for(var n=e.length,c=Se(i.length,n),h=De(e);c--;){var d=i[c];e[c]=Nt(d,n)?h[d]:r}return e}function zn(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Vc=Fc(pc),ui=Ed||function(e,i){return Ee.setTimeout(e,i)},Hn=Fc(Tf);function Kc(e,i,n){var c=i+"";return Hn(e,Xf(c,ug(Jf(c),n)))}function Fc(e){var i=0,n=0;return function(){var c=Od(),h=$l-(c-n);if(n=c,h>0){if(++i>=Nl)return arguments[0]}else i=0;return e.apply(r,arguments)}}function hs(e,i){var n=-1,c=e.length,h=c-1;for(i=i===r?c:i;++n<i;){var d=Pn(n,h),f=e[d];e[d]=e[n],e[n]=f}return e.length=i,e}var Wc=sg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Yl,function(n,c,h,d){i.push(h?d.replace(np,"$1"):c||n)}),i});function wt(e){if(typeof e=="string"||Fe(e))return e;var i=e+"";return i=="0"&&1/e==-Zt?"-0":i}function or(e){if(e!=null){try{return Li.call(e)}catch{}try{return e+""}catch{}}return""}function ug(e,i){return Ye(ql,function(n){var c="_."+n[0];i&n[1]&&!Di(e,c)&&e.push(c)}),e.sort()}function Bc(e){if(e instanceof G)return e.clone();var i=new Xe(e.__wrapped__,e.__chain__);return i.__actions__=De(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function hg(e,i,n){(n?Te(e,i,n):i===r)?i=1:i=we(H(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var h=0,d=0,f=_(Wi(c/i));h<c;)f[d++]=tt(e,h,h+=i);return f}function lg(e){for(var i=-1,n=e==null?0:e.length,c=0,h=[];++i<n;){var d=e[i];d&&(h[c++]=d)}return h}function pg(){var e=arguments.length;if(!e)return[];for(var i=_(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return Lt(z(n)?De(n):[n],Ie(i,1))}var dg=F(function(e,i){return fe(e)?ii(e,Ie(i,1,fe,!0)):[]}),fg=F(function(e,i){var n=rt(i);return fe(n)&&(n=r),fe(e)?ii(e,Ie(i,1,fe,!0),U(n,2)):[]}),gg=F(function(e,i){var n=rt(i);return fe(n)&&(n=r),fe(e)?ii(e,Ie(i,1,fe,!0),r,n):[]});function yg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:H(i),tt(e,i<0?0:i,c)):[]}function vg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:H(i),i=c-i,tt(e,0,i<0?0:i)):[]}function mg(e,i){return e&&e.length?rs(e,U(i,3),!0,!0):[]}function wg(e,i){return e&&e.length?rs(e,U(i,3),!0):[]}function _g(e,i,n,c){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Te(e,i,n)&&(n=0,c=h),pf(e,i,n,c)):[]}function Gc(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:H(n);return h<0&&(h=we(c+h,0)),qi(e,U(i,3),h)}function Qc(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c-1;return n!==r&&(h=H(n),h=n<0?we(c+h,0):Se(h,c-1)),qi(e,U(i,3),h,!0)}function Jc(e){var i=e==null?0:e.length;return i?Ie(e,1):[]}function bg(e){var i=e==null?0:e.length;return i?Ie(e,Zt):[]}function Eg(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:H(i),Ie(e,i)):[]}function Ig(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var h=e[i];c[h[0]]=h[1]}return c}function Yc(e){return e&&e.length?e[0]:r}function Pg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:H(n);return h<0&&(h=we(c+h,0)),wr(e,i,h)}function Sg(e){var i=e==null?0:e.length;return i?tt(e,0,-1):[]}var Og=F(function(e){var i=ce(e,$n);return i.length&&i[0]===e[0]?wn(i):[]}),Rg=F(function(e){var i=rt(e),n=ce(e,$n);return i===rt(n)?i=r:n.pop(),n.length&&n[0]===e[0]?wn(n,U(i,2)):[]}),Ng=F(function(e){var i=rt(e),n=ce(e,$n);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?wn(n,r,i):[]});function $g(e,i){return e==null?"":Pd.call(e,i)}function rt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Cg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c;return n!==r&&(h=H(n),h=h<0?we(c+h,0):Se(h,c-1)),i===i?cd(e,i,h):qi(e,Ta,h,!0)}function Tg(e,i){return e&&e.length?cc(e,H(i)):r}var Ag=F(Zc);function Zc(e,i){return e&&e.length&&i&&i.length?In(e,i):e}function xg(e,i,n){return e&&e.length&&i&&i.length?In(e,i,U(n,2)):e}function Dg(e,i,n){return e&&e.length&&i&&i.length?In(e,i,r,n):e}var qg=Rt(function(e,i){var n=e==null?0:e.length,c=gn(e,i);return lc(e,ce(i,function(h){return Nt(h,n)?+h:h}).sort(bc)),c});function jg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,h=[],d=e.length;for(i=U(i,3);++c<d;){var f=e[c];i(f,c,e)&&(n.push(f),h.push(c))}return lc(e,h),n}function Vn(e){return e==null?e:Nd.call(e)}function Ug(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Te(e,i,n)?(i=0,n=c):(i=i==null?0:H(i),n=n===r?c:H(n)),tt(e,i,n)):[]}function Mg(e,i){return ts(e,i)}function Lg(e,i,n){return On(e,i,U(n,2))}function kg(e,i){var n=e==null?0:e.length;if(n){var c=ts(e,i);if(c<n&&ht(e[c],i))return c}return-1}function zg(e,i){return ts(e,i,!0)}function Hg(e,i,n){return On(e,i,U(n,2),!0)}function Vg(e,i){var n=e==null?0:e.length;if(n){var c=ts(e,i,!0)-1;if(ht(e[c],i))return c}return-1}function Kg(e){return e&&e.length?dc(e):[]}function Fg(e,i){return e&&e.length?dc(e,U(i,2)):[]}function Wg(e){var i=e==null?0:e.length;return i?tt(e,1,i):[]}function Bg(e,i,n){return e&&e.length?(i=n||i===r?1:H(i),tt(e,0,i<0?0:i)):[]}function Gg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:H(i),i=c-i,tt(e,i<0?0:i,c)):[]}function Qg(e,i){return e&&e.length?rs(e,U(i,3),!1,!0):[]}function Jg(e,i){return e&&e.length?rs(e,U(i,3)):[]}var Yg=F(function(e){return Vt(Ie(e,1,fe,!0))}),Zg=F(function(e){var i=rt(e);return fe(i)&&(i=r),Vt(Ie(e,1,fe,!0),U(i,2))}),Xg=F(function(e){var i=rt(e);return i=typeof i=="function"?i:r,Vt(Ie(e,1,fe,!0),r,i)});function ey(e){return e&&e.length?Vt(e):[]}function ty(e,i){return e&&e.length?Vt(e,U(i,2)):[]}function ry(e,i){return i=typeof i=="function"?i:r,e&&e.length?Vt(e,r,i):[]}function Kn(e){if(!(e&&e.length))return[];var i=0;return e=Mt(e,function(n){if(fe(n))return i=we(n.length,i),!0}),an(i,function(n){return ce(e,sn(n))})}function Xc(e,i){if(!(e&&e.length))return[];var n=Kn(e);return i==null?n:ce(n,function(c){return He(i,r,c)})}var iy=F(function(e,i){return fe(e)?ii(e,i):[]}),sy=F(function(e){return Nn(Mt(e,fe))}),ny=F(function(e){var i=rt(e);return fe(i)&&(i=r),Nn(Mt(e,fe),U(i,2))}),oy=F(function(e){var i=rt(e);return i=typeof i=="function"?i:r,Nn(Mt(e,fe),r,i)}),ay=F(Kn);function cy(e,i){return vc(e||[],i||[],ri)}function uy(e,i){return vc(e||[],i||[],oi)}var hy=F(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Xc(e,n)});function eu(e){var i=p(e);return i.__chain__=!0,i}function ly(e,i){return i(e),e}function ls(e,i){return i(e)}var py=Rt(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,h=function(d){return gn(d,e)};return i>1||this.__actions__.length||!(c instanceof G)||!Nt(n)?this.thru(h):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:ls,args:[h],thisArg:r}),new Xe(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function dy(){return eu(this)}function fy(){return new Xe(this.value(),this.__chain__)}function gy(){this.__values__===r&&(this.__values__=fu(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function yy(){return this}function vy(e){for(var i,n=this;n instanceof Ji;){var c=Bc(n);c.__index__=0,c.__values__=r,i?h.__wrapped__=c:i=c;var h=c;n=n.__wrapped__}return h.__wrapped__=e,i}function my(){var e=this.__wrapped__;if(e instanceof G){var i=e;return this.__actions__.length&&(i=new G(this)),i=i.reverse(),i.__actions__.push({func:ls,args:[Vn],thisArg:r}),new Xe(i,this.__chain__)}return this.thru(Vn)}function wy(){return yc(this.__wrapped__,this.__actions__)}var _y=is(function(e,i,n){ee.call(e,n)?++e[n]:St(e,n,1)});function by(e,i,n){var c=z(e)?$a:lf;return n&&Te(e,i,n)&&(i=r),c(e,U(i,3))}function Ey(e,i){var n=z(e)?Mt:Xa;return n(e,U(i,3))}var Iy=Rc(Gc),Py=Rc(Qc);function Sy(e,i){return Ie(ps(e,i),1)}function Oy(e,i){return Ie(ps(e,i),Zt)}function Ry(e,i,n){return n=n===r?1:H(n),Ie(ps(e,i),n)}function tu(e,i){var n=z(e)?Ye:Ht;return n(e,U(i,3))}function ru(e,i){var n=z(e)?Fp:Za;return n(e,U(i,3))}var Ny=is(function(e,i,n){ee.call(e,n)?e[n].push(i):St(e,n,[i])});function $y(e,i,n,c){e=qe(e)?e:Tr(e),n=n&&!c?H(n):0;var h=e.length;return n<0&&(n=we(h+n,0)),vs(e)?n<=h&&e.indexOf(i,n)>-1:!!h&&wr(e,i,n)>-1}var Cy=F(function(e,i,n){var c=-1,h=typeof i=="function",d=qe(e)?_(e.length):[];return Ht(e,function(f){d[++c]=h?He(i,f,n):si(f,i,n)}),d}),Ty=is(function(e,i,n){St(e,n,i)});function ps(e,i){var n=z(e)?ce:nc;return n(e,U(i,3))}function Ay(e,i,n,c){return e==null?[]:(z(i)||(i=i==null?[]:[i]),n=c?r:n,z(n)||(n=n==null?[]:[n]),uc(e,i,n))}var xy=is(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function Dy(e,i,n){var c=z(e)?tn:xa,h=arguments.length<3;return c(e,U(i,4),n,h,Ht)}function qy(e,i,n){var c=z(e)?Wp:xa,h=arguments.length<3;return c(e,U(i,4),n,h,Za)}function jy(e,i){var n=z(e)?Mt:Xa;return n(e,gs(U(i,3)))}function Uy(e){var i=z(e)?Ga:$f;return i(e)}function My(e,i,n){(n?Te(e,i,n):i===r)?i=1:i=H(i);var c=z(e)?of:Cf;return c(e,i)}function Ly(e){var i=z(e)?af:Af;return i(e)}function ky(e){if(e==null)return 0;if(qe(e))return vs(e)?br(e):e.length;var i=Oe(e);return i==ot||i==at?e.size:bn(e).length}function zy(e,i,n){var c=z(e)?rn:xf;return n&&Te(e,i,n)&&(i=r),c(e,U(i,3))}var Hy=F(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Te(e,i[0],i[1])?i=[]:n>2&&Te(i[0],i[1],i[2])&&(i=[i[0]]),uc(e,Ie(i,1),[])}),ds=bd||function(){return Ee.Date.now()};function Vy(e,i){if(typeof i!="function")throw new Ze(l);return e=H(e),function(){if(--e<1)return i.apply(this,arguments)}}function iu(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Ot(e,de,r,r,r,r,i)}function su(e,i){var n;if(typeof i!="function")throw new Ze(l);return e=H(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Fn=F(function(e,i,n){var c=x;if(n.length){var h=kt(n,$r(Fn));c|=ae}return Ot(e,c,i,n,h)}),nu=F(function(e,i,n){var c=x|B;if(n.length){var h=kt(n,$r(nu));c|=ae}return Ot(i,c,e,n,h)});function ou(e,i,n){i=n?r:i;var c=Ot(e,J,r,r,r,r,r,i);return c.placeholder=ou.placeholder,c}function au(e,i,n){i=n?r:i;var c=Ot(e,Y,r,r,r,r,r,i);return c.placeholder=au.placeholder,c}function cu(e,i,n){var c,h,d,f,y,m,I=0,P=!1,O=!1,C=!0;if(typeof e!="function")throw new Ze(l);i=it(i)||0,he(n)&&(P=!!n.leading,O="maxWait"in n,d=O?we(it(n.maxWait)||0,i):d,C="trailing"in n?!!n.trailing:C);function D(ge){var lt=c,Tt=h;return c=h=r,I=ge,f=e.apply(Tt,lt),f}function M(ge){return I=ge,y=ui(W,i),P?D(ge):f}function V(ge){var lt=ge-m,Tt=ge-I,Ru=i-lt;return O?Se(Ru,d-Tt):Ru}function L(ge){var lt=ge-m,Tt=ge-I;return m===r||lt>=i||lt<0||O&&Tt>=d}function W(){var ge=ds();if(L(ge))return Q(ge);y=ui(W,V(ge))}function Q(ge){return y=r,C&&c?D(ge):(c=h=r,f)}function We(){y!==r&&mc(y),I=0,c=m=h=y=r}function Ae(){return y===r?f:Q(ds())}function Be(){var ge=ds(),lt=L(ge);if(c=arguments,h=this,m=ge,lt){if(y===r)return M(m);if(O)return mc(y),y=ui(W,i),D(m)}return y===r&&(y=ui(W,i)),f}return Be.cancel=We,Be.flush=Ae,Be}var Ky=F(function(e,i){return Ya(e,1,i)}),Fy=F(function(e,i,n){return Ya(e,it(i)||0,n)});function Wy(e){return Ot(e,jt)}function fs(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Ze(l);var n=function(){var c=arguments,h=i?i.apply(this,c):c[0],d=n.cache;if(d.has(h))return d.get(h);var f=e.apply(this,c);return n.cache=d.set(h,f)||d,f};return n.cache=new(fs.Cache||Pt),n}fs.Cache=Pt;function gs(e){if(typeof e!="function")throw new Ze(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function By(e){return su(2,e)}var Gy=Df(function(e,i){i=i.length==1&&z(i[0])?ce(i[0],Ve(U())):ce(Ie(i,1),Ve(U()));var n=i.length;return F(function(c){for(var h=-1,d=Se(c.length,n);++h<d;)c[h]=i[h].call(this,c[h]);return He(e,this,c)})}),Wn=F(function(e,i){var n=kt(i,$r(Wn));return Ot(e,ae,r,i,n)}),uu=F(function(e,i){var n=kt(i,$r(uu));return Ot(e,Ne,r,i,n)}),Qy=Rt(function(e,i){return Ot(e,$e,r,r,r,i)});function Jy(e,i){if(typeof e!="function")throw new Ze(l);return i=i===r?i:H(i),F(e,i)}function Yy(e,i){if(typeof e!="function")throw new Ze(l);return i=i==null?0:we(H(i),0),F(function(n){var c=n[i],h=Ft(n,0,i);return c&&Lt(h,c),He(e,this,h)})}function Zy(e,i,n){var c=!0,h=!0;if(typeof e!="function")throw new Ze(l);return he(n)&&(c="leading"in n?!!n.leading:c,h="trailing"in n?!!n.trailing:h),cu(e,i,{leading:c,maxWait:i,trailing:h})}function Xy(e){return iu(e,1)}function ev(e,i){return Wn(Cn(i),e)}function tv(){if(!arguments.length)return[];var e=arguments[0];return z(e)?e:[e]}function rv(e){return et(e,j)}function iv(e,i){return i=typeof i=="function"?i:r,et(e,j,i)}function sv(e){return et(e,S|j)}function nv(e,i){return i=typeof i=="function"?i:r,et(e,S|j,i)}function ov(e,i){return i==null||Ja(e,i,_e(i))}function ht(e,i){return e===i||e!==e&&i!==i}var av=as(mn),cv=as(function(e,i){return e>=i}),ar=rc(function(){return arguments}())?rc:function(e){return le(e)&&ee.call(e,"callee")&&!Ha.call(e,"callee")},z=_.isArray,uv=Ia?Ve(Ia):vf;function qe(e){return e!=null&&ys(e.length)&&!$t(e)}function fe(e){return le(e)&&qe(e)}function hv(e){return e===!0||e===!1||le(e)&&Ce(e)==Vr}var Wt=Id||io,lv=Pa?Ve(Pa):mf;function pv(e){return le(e)&&e.nodeType===1&&!hi(e)}function dv(e){if(e==null)return!0;if(qe(e)&&(z(e)||typeof e=="string"||typeof e.splice=="function"||Wt(e)||Cr(e)||ar(e)))return!e.length;var i=Oe(e);if(i==ot||i==at)return!e.size;if(ci(e))return!bn(e).length;for(var n in e)if(ee.call(e,n))return!1;return!0}function fv(e,i){return ni(e,i)}function gv(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?ni(e,i,r,n):!!c}function Bn(e){if(!le(e))return!1;var i=Ce(e);return i==Ni||i==Ul||typeof e.message=="string"&&typeof e.name=="string"&&!hi(e)}function yv(e){return typeof e=="number"&&Ka(e)}function $t(e){if(!he(e))return!1;var i=Ce(e);return i==$i||i==Yo||i==jl||i==Ll}function hu(e){return typeof e=="number"&&e==H(e)}function ys(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ut}function he(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function le(e){return e!=null&&typeof e=="object"}var lu=Sa?Ve(Sa):_f;function vv(e,i){return e===i||_n(e,i,Un(i))}function mv(e,i,n){return n=typeof n=="function"?n:r,_n(e,i,Un(i),n)}function wv(e){return pu(e)&&e!=+e}function _v(e){if(ig(e))throw new k(u);return ic(e)}function bv(e){return e===null}function Ev(e){return e==null}function pu(e){return typeof e=="number"||le(e)&&Ce(e)==Fr}function hi(e){if(!le(e)||Ce(e)!=Et)return!1;var i=Vi(e);if(i===null)return!0;var n=ee.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Li.call(n)==vd}var Gn=Oa?Ve(Oa):bf;function Iv(e){return hu(e)&&e>=-Ut&&e<=Ut}var du=Ra?Ve(Ra):Ef;function vs(e){return typeof e=="string"||!z(e)&&le(e)&&Ce(e)==Br}function Fe(e){return typeof e=="symbol"||le(e)&&Ce(e)==Ci}var Cr=Na?Ve(Na):If;function Pv(e){return e===r}function Sv(e){return le(e)&&Oe(e)==Gr}function Ov(e){return le(e)&&Ce(e)==zl}var Rv=as(En),Nv=as(function(e,i){return e<=i});function fu(e){if(!e)return[];if(qe(e))return vs(e)?ct(e):De(e);if(Yr&&e[Yr])return nd(e[Yr]());var i=Oe(e),n=i==ot?un:i==at?ji:Tr;return n(e)}function Ct(e){if(!e)return e===0?e:0;if(e=it(e),e===Zt||e===-Zt){var i=e<0?-1:1;return i*Al}return e===e?e:0}function H(e){var i=Ct(e),n=i%1;return i===i?n?i-n:i:0}function gu(e){return e?ir(H(e),0,yt):0}function it(e){if(typeof e=="number")return e;if(Fe(e))return Oi;if(he(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=he(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Da(e);var n=cp.test(e);return n||hp.test(e)?Hp(e.slice(2),n?2:8):ap.test(e)?Oi:+e}function yu(e){return mt(e,je(e))}function $v(e){return e?ir(H(e),-Ut,Ut):e===0?e:0}function X(e){return e==null?"":Ke(e)}var Cv=Rr(function(e,i){if(ci(i)||qe(i)){mt(i,_e(i),e);return}for(var n in i)ee.call(i,n)&&ri(e,n,i[n])}),vu=Rr(function(e,i){mt(i,je(i),e)}),ms=Rr(function(e,i,n,c){mt(i,je(i),e,c)}),Tv=Rr(function(e,i,n,c){mt(i,_e(i),e,c)}),Av=Rt(gn);function xv(e,i){var n=Or(e);return i==null?n:Qa(n,i)}var Dv=F(function(e,i){e=re(e);var n=-1,c=i.length,h=c>2?i[2]:r;for(h&&Te(i[0],i[1],h)&&(c=1);++n<c;)for(var d=i[n],f=je(d),y=-1,m=f.length;++y<m;){var I=f[y],P=e[I];(P===r||ht(P,Ir[I])&&!ee.call(e,I))&&(e[I]=d[I])}return e}),qv=F(function(e){return e.push(r,Dc),He(mu,r,e)});function jv(e,i){return Ca(e,U(i,3),vt)}function Uv(e,i){return Ca(e,U(i,3),vn)}function Mv(e,i){return e==null?e:yn(e,U(i,3),je)}function Lv(e,i){return e==null?e:ec(e,U(i,3),je)}function kv(e,i){return e&&vt(e,U(i,3))}function zv(e,i){return e&&vn(e,U(i,3))}function Hv(e){return e==null?[]:Xi(e,_e(e))}function Vv(e){return e==null?[]:Xi(e,je(e))}function Qn(e,i,n){var c=e==null?r:sr(e,i);return c===r?n:c}function Kv(e,i){return e!=null&&Uc(e,i,df)}function Jn(e,i){return e!=null&&Uc(e,i,ff)}var Fv=$c(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=ki.call(i)),e[i]=n},Zn(Ue)),Wv=$c(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=ki.call(i)),ee.call(e,i)?e[i].push(n):e[i]=[n]},U),Bv=F(si);function _e(e){return qe(e)?Ba(e):bn(e)}function je(e){return qe(e)?Ba(e,!0):Pf(e)}function Gv(e,i){var n={};return i=U(i,3),vt(e,function(c,h,d){St(n,i(c,h,d),c)}),n}function Qv(e,i){var n={};return i=U(i,3),vt(e,function(c,h,d){St(n,h,i(c,h,d))}),n}var Jv=Rr(function(e,i,n){es(e,i,n)}),mu=Rr(function(e,i,n,c){es(e,i,n,c)}),Yv=Rt(function(e,i){var n={};if(e==null)return n;var c=!1;i=ce(i,function(d){return d=Kt(d,e),c||(c=d.length>1),d}),mt(e,qn(e),n),c&&(n=et(n,S|R|j,Ff));for(var h=i.length;h--;)Rn(n,i[h]);return n});function Zv(e,i){return wu(e,gs(U(i)))}var Xv=Rt(function(e,i){return e==null?{}:Of(e,i)});function wu(e,i){if(e==null)return{};var n=ce(qn(e),function(c){return[c]});return i=U(i),hc(e,n,function(c,h){return i(c,h[0])})}function em(e,i,n){i=Kt(i,e);var c=-1,h=i.length;for(h||(h=1,e=r);++c<h;){var d=e==null?r:e[wt(i[c])];d===r&&(c=h,d=n),e=$t(d)?d.call(e):d}return e}function tm(e,i,n){return e==null?e:oi(e,i,n)}function rm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:oi(e,i,n,c)}var _u=Ac(_e),bu=Ac(je);function im(e,i,n){var c=z(e),h=c||Wt(e)||Cr(e);if(i=U(i,4),n==null){var d=e&&e.constructor;h?n=c?new d:[]:he(e)?n=$t(d)?Or(Vi(e)):{}:n={}}return(h?Ye:vt)(e,function(f,y,m){return i(n,f,y,m)}),n}function sm(e,i){return e==null?!0:Rn(e,i)}function nm(e,i,n){return e==null?e:gc(e,i,Cn(n))}function om(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:gc(e,i,Cn(n),c)}function Tr(e){return e==null?[]:cn(e,_e(e))}function am(e){return e==null?[]:cn(e,je(e))}function cm(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=it(n),n=n===n?n:0),i!==r&&(i=it(i),i=i===i?i:0),ir(it(e),i,n)}function um(e,i,n){return i=Ct(i),n===r?(n=i,i=0):n=Ct(n),e=it(e),gf(e,i,n)}function hm(e,i,n){if(n&&typeof n!="boolean"&&Te(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Ct(e),i===r?(i=e,e=0):i=Ct(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var h=Fa();return Se(e+h*(i-e+zp("1e-"+((h+"").length-1))),i)}return Pn(e,i)}var lm=Nr(function(e,i,n){return i=i.toLowerCase(),e+(n?Eu(i):i)});function Eu(e){return Yn(X(e).toLowerCase())}function Iu(e){return e=X(e),e&&e.replace(pp,ed).replace(Tp,"")}function pm(e,i,n){e=X(e),i=Ke(i);var c=e.length;n=n===r?c:ir(H(n),0,c);var h=n;return n-=i.length,n>=0&&e.slice(n,h)==i}function dm(e){return e=X(e),e&&Wl.test(e)?e.replace(ea,td):e}function fm(e){return e=X(e),e&&Zl.test(e)?e.replace(Fs,"\\$&"):e}var gm=Nr(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),ym=Nr(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),vm=Oc("toLowerCase");function mm(e,i,n){e=X(e),i=H(i);var c=i?br(e):0;if(!i||c>=i)return e;var h=(i-c)/2;return os(Bi(h),n)+e+os(Wi(h),n)}function wm(e,i,n){e=X(e),i=H(i);var c=i?br(e):0;return i&&c<i?e+os(i-c,n):e}function _m(e,i,n){e=X(e),i=H(i);var c=i?br(e):0;return i&&c<i?os(i-c,n)+e:e}function bm(e,i,n){return n||i==null?i=0:i&&(i=+i),Rd(X(e).replace(Ws,""),i||0)}function Em(e,i,n){return(n?Te(e,i,n):i===r)?i=1:i=H(i),Sn(X(e),i)}function Im(){var e=arguments,i=X(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Pm=Nr(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function Sm(e,i,n){return n&&typeof n!="number"&&Te(e,i,n)&&(i=n=r),n=n===r?yt:n>>>0,n?(e=X(e),e&&(typeof i=="string"||i!=null&&!Gn(i))&&(i=Ke(i),!i&&_r(e))?Ft(ct(e),0,n):e.split(i,n)):[]}var Om=Nr(function(e,i,n){return e+(n?" ":"")+Yn(i)});function Rm(e,i,n){return e=X(e),n=n==null?0:ir(H(n),0,e.length),i=Ke(i),e.slice(n,n+i.length)==i}function Nm(e,i,n){var c=p.templateSettings;n&&Te(e,i,n)&&(i=r),e=X(e),i=ms({},i,c,xc);var h=ms({},i.imports,c.imports,xc),d=_e(h),f=cn(h,d),y,m,I=0,P=i.interpolate||Ti,O="__p += '",C=hn((i.escape||Ti).source+"|"+P.source+"|"+(P===ta?op:Ti).source+"|"+(i.evaluate||Ti).source+"|$","g"),D="//# sourceURL="+(ee.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++jp+"]")+`
`;e.replace(C,function(L,W,Q,We,Ae,Be){return Q||(Q=We),O+=e.slice(I,Be).replace(dp,rd),W&&(y=!0,O+=`' +
__e(`+W+`) +
'`),Ae&&(m=!0,O+=`';
`+Ae+`;
__p += '`),Q&&(O+=`' +
((__t = (`+Q+`)) == null ? '' : __t) +
'`),I=Be+L.length,L}),O+=`';
`;var M=ee.call(i,"variable")&&i.variable;if(!M)O=`with (obj) {
`+O+`
}
`;else if(sp.test(M))throw new k(g);O=(m?O.replace(Hl,""):O).replace(Vl,"$1").replace(Kl,"$1;"),O="function("+(M||"obj")+`) {
`+(M?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+O+`return __p
}`;var V=Su(function(){return Z(d,D+"return "+O).apply(r,f)});if(V.source=O,Bn(V))throw V;return V}function $m(e){return X(e).toLowerCase()}function Cm(e){return X(e).toUpperCase()}function Tm(e,i,n){if(e=X(e),e&&(n||i===r))return Da(e);if(!e||!(i=Ke(i)))return e;var c=ct(e),h=ct(i),d=qa(c,h),f=ja(c,h)+1;return Ft(c,d,f).join("")}function Am(e,i,n){if(e=X(e),e&&(n||i===r))return e.slice(0,Ma(e)+1);if(!e||!(i=Ke(i)))return e;var c=ct(e),h=ja(c,ct(i))+1;return Ft(c,0,h).join("")}function xm(e,i,n){if(e=X(e),e&&(n||i===r))return e.replace(Ws,"");if(!e||!(i=Ke(i)))return e;var c=ct(e),h=qa(c,ct(i));return Ft(c,h).join("")}function Dm(e,i){var n=Ol,c=Rl;if(he(i)){var h="separator"in i?i.separator:h;n="length"in i?H(i.length):n,c="omission"in i?Ke(i.omission):c}e=X(e);var d=e.length;if(_r(e)){var f=ct(e);d=f.length}if(n>=d)return e;var y=n-br(c);if(y<1)return c;var m=f?Ft(f,0,y).join(""):e.slice(0,y);if(h===r)return m+c;if(f&&(y+=m.length-y),Gn(h)){if(e.slice(y).search(h)){var I,P=m;for(h.global||(h=hn(h.source,X(ra.exec(h))+"g")),h.lastIndex=0;I=h.exec(P);)var O=I.index;m=m.slice(0,O===r?y:O)}}else if(e.indexOf(Ke(h),y)!=y){var C=m.lastIndexOf(h);C>-1&&(m=m.slice(0,C))}return m+c}function qm(e){return e=X(e),e&&Fl.test(e)?e.replace(Xo,ud):e}var jm=Nr(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Yn=Oc("toUpperCase");function Pu(e,i,n){return e=X(e),i=n?r:i,i===r?sd(e)?pd(e):Qp(e):e.match(i)||[]}var Su=F(function(e,i){try{return He(e,r,i)}catch(n){return Bn(n)?n:new k(n)}}),Um=Rt(function(e,i){return Ye(i,function(n){n=wt(n),St(e,n,Fn(e[n],e))}),e});function Mm(e){var i=e==null?0:e.length,n=U();return e=i?ce(e,function(c){if(typeof c[1]!="function")throw new Ze(l);return[n(c[0]),c[1]]}):[],F(function(c){for(var h=-1;++h<i;){var d=e[h];if(He(d[0],this,c))return He(d[1],this,c)}})}function Lm(e){return hf(et(e,S))}function Zn(e){return function(){return e}}function km(e,i){return e==null||e!==e?i:e}var zm=Nc(),Hm=Nc(!0);function Ue(e){return e}function Xn(e){return sc(typeof e=="function"?e:et(e,S))}function Vm(e){return oc(et(e,S))}function Km(e,i){return ac(e,et(i,S))}var Fm=F(function(e,i){return function(n){return si(n,e,i)}}),Wm=F(function(e,i){return function(n){return si(e,n,i)}});function eo(e,i,n){var c=_e(i),h=Xi(i,c);n==null&&!(he(i)&&(h.length||!c.length))&&(n=i,i=e,e=this,h=Xi(i,_e(i)));var d=!(he(n)&&"chain"in n)||!!n.chain,f=$t(e);return Ye(h,function(y){var m=i[y];e[y]=m,f&&(e.prototype[y]=function(){var I=this.__chain__;if(d||I){var P=e(this.__wrapped__),O=P.__actions__=De(this.__actions__);return O.push({func:m,args:arguments,thisArg:e}),P.__chain__=I,P}return m.apply(e,Lt([this.value()],arguments))})}),e}function Bm(){return Ee._===this&&(Ee._=md),this}function to(){}function Gm(e){return e=H(e),F(function(i){return cc(i,e)})}var Qm=An(ce),Jm=An($a),Ym=An(rn);function Ou(e){return Ln(e)?sn(wt(e)):Rf(e)}function Zm(e){return function(i){return e==null?r:sr(e,i)}}var Xm=Cc(),ew=Cc(!0);function ro(){return[]}function io(){return!1}function tw(){return{}}function rw(){return""}function iw(){return!0}function sw(e,i){if(e=H(e),e<1||e>Ut)return[];var n=yt,c=Se(e,yt);i=U(i),e-=yt;for(var h=an(c,i);++n<e;)i(n);return h}function nw(e){return z(e)?ce(e,wt):Fe(e)?[e]:De(Wc(X(e)))}function ow(e){var i=++yd;return X(e)+i}var aw=ns(function(e,i){return e+i},0),cw=xn("ceil"),uw=ns(function(e,i){return e/i},1),hw=xn("floor");function lw(e){return e&&e.length?Zi(e,Ue,mn):r}function pw(e,i){return e&&e.length?Zi(e,U(i,2),mn):r}function dw(e){return Aa(e,Ue)}function fw(e,i){return Aa(e,U(i,2))}function gw(e){return e&&e.length?Zi(e,Ue,En):r}function yw(e,i){return e&&e.length?Zi(e,U(i,2),En):r}var vw=ns(function(e,i){return e*i},1),mw=xn("round"),ww=ns(function(e,i){return e-i},0);function _w(e){return e&&e.length?on(e,Ue):0}function bw(e,i){return e&&e.length?on(e,U(i,2)):0}return p.after=Vy,p.ary=iu,p.assign=Cv,p.assignIn=vu,p.assignInWith=ms,p.assignWith=Tv,p.at=Av,p.before=su,p.bind=Fn,p.bindAll=Um,p.bindKey=nu,p.castArray=tv,p.chain=eu,p.chunk=hg,p.compact=lg,p.concat=pg,p.cond=Mm,p.conforms=Lm,p.constant=Zn,p.countBy=_y,p.create=xv,p.curry=ou,p.curryRight=au,p.debounce=cu,p.defaults=Dv,p.defaultsDeep=qv,p.defer=Ky,p.delay=Fy,p.difference=dg,p.differenceBy=fg,p.differenceWith=gg,p.drop=yg,p.dropRight=vg,p.dropRightWhile=mg,p.dropWhile=wg,p.fill=_g,p.filter=Ey,p.flatMap=Sy,p.flatMapDeep=Oy,p.flatMapDepth=Ry,p.flatten=Jc,p.flattenDeep=bg,p.flattenDepth=Eg,p.flip=Wy,p.flow=zm,p.flowRight=Hm,p.fromPairs=Ig,p.functions=Hv,p.functionsIn=Vv,p.groupBy=Ny,p.initial=Sg,p.intersection=Og,p.intersectionBy=Rg,p.intersectionWith=Ng,p.invert=Fv,p.invertBy=Wv,p.invokeMap=Cy,p.iteratee=Xn,p.keyBy=Ty,p.keys=_e,p.keysIn=je,p.map=ps,p.mapKeys=Gv,p.mapValues=Qv,p.matches=Vm,p.matchesProperty=Km,p.memoize=fs,p.merge=Jv,p.mergeWith=mu,p.method=Fm,p.methodOf=Wm,p.mixin=eo,p.negate=gs,p.nthArg=Gm,p.omit=Yv,p.omitBy=Zv,p.once=By,p.orderBy=Ay,p.over=Qm,p.overArgs=Gy,p.overEvery=Jm,p.overSome=Ym,p.partial=Wn,p.partialRight=uu,p.partition=xy,p.pick=Xv,p.pickBy=wu,p.property=Ou,p.propertyOf=Zm,p.pull=Ag,p.pullAll=Zc,p.pullAllBy=xg,p.pullAllWith=Dg,p.pullAt=qg,p.range=Xm,p.rangeRight=ew,p.rearg=Qy,p.reject=jy,p.remove=jg,p.rest=Jy,p.reverse=Vn,p.sampleSize=My,p.set=tm,p.setWith=rm,p.shuffle=Ly,p.slice=Ug,p.sortBy=Hy,p.sortedUniq=Kg,p.sortedUniqBy=Fg,p.split=Sm,p.spread=Yy,p.tail=Wg,p.take=Bg,p.takeRight=Gg,p.takeRightWhile=Qg,p.takeWhile=Jg,p.tap=ly,p.throttle=Zy,p.thru=ls,p.toArray=fu,p.toPairs=_u,p.toPairsIn=bu,p.toPath=nw,p.toPlainObject=yu,p.transform=im,p.unary=Xy,p.union=Yg,p.unionBy=Zg,p.unionWith=Xg,p.uniq=ey,p.uniqBy=ty,p.uniqWith=ry,p.unset=sm,p.unzip=Kn,p.unzipWith=Xc,p.update=nm,p.updateWith=om,p.values=Tr,p.valuesIn=am,p.without=iy,p.words=Pu,p.wrap=ev,p.xor=sy,p.xorBy=ny,p.xorWith=oy,p.zip=ay,p.zipObject=cy,p.zipObjectDeep=uy,p.zipWith=hy,p.entries=_u,p.entriesIn=bu,p.extend=vu,p.extendWith=ms,eo(p,p),p.add=aw,p.attempt=Su,p.camelCase=lm,p.capitalize=Eu,p.ceil=cw,p.clamp=cm,p.clone=rv,p.cloneDeep=sv,p.cloneDeepWith=nv,p.cloneWith=iv,p.conformsTo=ov,p.deburr=Iu,p.defaultTo=km,p.divide=uw,p.endsWith=pm,p.eq=ht,p.escape=dm,p.escapeRegExp=fm,p.every=by,p.find=Iy,p.findIndex=Gc,p.findKey=jv,p.findLast=Py,p.findLastIndex=Qc,p.findLastKey=Uv,p.floor=hw,p.forEach=tu,p.forEachRight=ru,p.forIn=Mv,p.forInRight=Lv,p.forOwn=kv,p.forOwnRight=zv,p.get=Qn,p.gt=av,p.gte=cv,p.has=Kv,p.hasIn=Jn,p.head=Yc,p.identity=Ue,p.includes=$y,p.indexOf=Pg,p.inRange=um,p.invoke=Bv,p.isArguments=ar,p.isArray=z,p.isArrayBuffer=uv,p.isArrayLike=qe,p.isArrayLikeObject=fe,p.isBoolean=hv,p.isBuffer=Wt,p.isDate=lv,p.isElement=pv,p.isEmpty=dv,p.isEqual=fv,p.isEqualWith=gv,p.isError=Bn,p.isFinite=yv,p.isFunction=$t,p.isInteger=hu,p.isLength=ys,p.isMap=lu,p.isMatch=vv,p.isMatchWith=mv,p.isNaN=wv,p.isNative=_v,p.isNil=Ev,p.isNull=bv,p.isNumber=pu,p.isObject=he,p.isObjectLike=le,p.isPlainObject=hi,p.isRegExp=Gn,p.isSafeInteger=Iv,p.isSet=du,p.isString=vs,p.isSymbol=Fe,p.isTypedArray=Cr,p.isUndefined=Pv,p.isWeakMap=Sv,p.isWeakSet=Ov,p.join=$g,p.kebabCase=gm,p.last=rt,p.lastIndexOf=Cg,p.lowerCase=ym,p.lowerFirst=vm,p.lt=Rv,p.lte=Nv,p.max=lw,p.maxBy=pw,p.mean=dw,p.meanBy=fw,p.min=gw,p.minBy=yw,p.stubArray=ro,p.stubFalse=io,p.stubObject=tw,p.stubString=rw,p.stubTrue=iw,p.multiply=vw,p.nth=Tg,p.noConflict=Bm,p.noop=to,p.now=ds,p.pad=mm,p.padEnd=wm,p.padStart=_m,p.parseInt=bm,p.random=hm,p.reduce=Dy,p.reduceRight=qy,p.repeat=Em,p.replace=Im,p.result=em,p.round=mw,p.runInContext=v,p.sample=Uy,p.size=ky,p.snakeCase=Pm,p.some=zy,p.sortedIndex=Mg,p.sortedIndexBy=Lg,p.sortedIndexOf=kg,p.sortedLastIndex=zg,p.sortedLastIndexBy=Hg,p.sortedLastIndexOf=Vg,p.startCase=Om,p.startsWith=Rm,p.subtract=ww,p.sum=_w,p.sumBy=bw,p.template=Nm,p.times=sw,p.toFinite=Ct,p.toInteger=H,p.toLength=gu,p.toLower=$m,p.toNumber=it,p.toSafeInteger=$v,p.toString=X,p.toUpper=Cm,p.trim=Tm,p.trimEnd=Am,p.trimStart=xm,p.truncate=Dm,p.unescape=qm,p.uniqueId=ow,p.upperCase=jm,p.upperFirst=Yn,p.each=tu,p.eachRight=ru,p.first=Yc,eo(p,function(){var e={};return vt(p,function(i,n){ee.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),Ye(["drop","take"],function(e,i){G.prototype[e]=function(n){n=n===r?1:we(H(n),0);var c=this.__filtered__&&!i?new G(this):this.clone();return c.__filtered__?c.__takeCount__=Se(n,c.__takeCount__):c.__views__.push({size:Se(n,yt),type:e+(c.__dir__<0?"Right":"")}),c},G.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Ye(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==Jo||n==Tl;G.prototype[e]=function(h){var d=this.clone();return d.__iteratees__.push({iteratee:U(h,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),Ye(["head","last"],function(e,i){var n="take"+(i?"Right":"");G.prototype[e]=function(){return this[n](1).value()[0]}}),Ye(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");G.prototype[e]=function(){return this.__filtered__?new G(this):this[n](1)}}),G.prototype.compact=function(){return this.filter(Ue)},G.prototype.find=function(e){return this.filter(e).head()},G.prototype.findLast=function(e){return this.reverse().find(e)},G.prototype.invokeMap=F(function(e,i){return typeof e=="function"?new G(this):this.map(function(n){return si(n,e,i)})}),G.prototype.reject=function(e){return this.filter(gs(U(e)))},G.prototype.slice=function(e,i){e=H(e);var n=this;return n.__filtered__&&(e>0||i<0)?new G(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=H(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},G.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},G.prototype.toArray=function(){return this.take(yt)},vt(G.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),h=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);h&&(p.prototype[i]=function(){var f=this.__wrapped__,y=c?[1]:arguments,m=f instanceof G,I=y[0],P=m||z(f),O=function(W){var Q=h.apply(p,Lt([W],y));return c&&C?Q[0]:Q};P&&n&&typeof I=="function"&&I.length!=1&&(m=P=!1);var C=this.__chain__,D=!!this.__actions__.length,M=d&&!C,V=m&&!D;if(!d&&P){f=V?f:new G(this);var L=e.apply(f,y);return L.__actions__.push({func:ls,args:[O],thisArg:r}),new Xe(L,C)}return M&&V?e.apply(this,y):(L=this.thru(O),M?c?L.value()[0]:L.value():L)})}),Ye(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ui[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var h=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(z(d)?d:[],h)}return this[n](function(f){return i.apply(z(f)?f:[],h)})}}),vt(G.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";ee.call(Sr,c)||(Sr[c]=[]),Sr[c].push({name:i,func:n})}}),Sr[ss(r,B).name]=[{name:"wrapper",func:r}],G.prototype.clone=Dd,G.prototype.reverse=qd,G.prototype.value=jd,p.prototype.at=py,p.prototype.chain=dy,p.prototype.commit=fy,p.prototype.next=gy,p.prototype.plant=vy,p.prototype.reverse=my,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=wy,p.prototype.first=p.prototype.head,Yr&&(p.prototype[Yr]=yy),p},Er=dd();Xt?((Xt.exports=Er)._=Er,Zs._=Er):Ee._=Er}).call(vi)})($o,$o.exports);var NI=Object.defineProperty,$I=Object.defineProperties,CI=Object.getOwnPropertyDescriptors,Th=Object.getOwnPropertySymbols,TI=Object.prototype.hasOwnProperty,AI=Object.prototype.propertyIsEnumerable,Ah=(o,t,r)=>t in o?NI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,bs=(o,t)=>{for(var r in t||(t={}))TI.call(t,r)&&Ah(o,r,t[r]);if(Th)for(var r of Th(t))AI.call(t,r)&&Ah(o,r,t[r]);return o},xI=(o,t)=>$I(o,CI(t));function Jt(o,t,r){var s;const a=a_(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${RI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function gr(o){return o.includes(":")?o.split(":")[1]:o}function Pl(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function DI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function qI(o={},t={}){const r=xh(o),s=xh(t);return $o.exports.merge(r,s)}function xh(o){var t,r,s,a;const u={};if(!jr(o))return u;for(const[l,g]of Object.entries(o)){const w=Vo(l)?[l]:g.chains,b=g.methods||[],N=g.events||[],S=g.rpcMap||{},R=mi(l);u[R]=xI(bs(bs({},u[R]),g),{chains:oo(w,(t=u[R])==null?void 0:t.chains),methods:oo(b,(r=u[R])==null?void 0:r.methods),events:oo(N,(s=u[R])==null?void 0:s.events),rpcMap:bs(bs({},S),(a=u[R])==null?void 0:a.rpcMap)})}return u}function jI(o){return o.includes(":")?o.split(":")[2]:o}function UI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],l=s.accounts||[],g=Vo(r)?[r]:s.chains?s.chains:Pl(s.accounts);t[r]={chains:g,methods:a,events:u,accounts:l}}return t}function fo(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Sl={},ue=o=>Sl[o],go=(o,t)=>{Sl[o]=t};class MI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=gr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class LI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Jt(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(gr(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class kI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=gr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class zI{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=gr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class HI{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=gr(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class VI{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=gr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class KI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=gr(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Dt(new Yt(s,ue("disableProviderPing")))}}class FI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Jt(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Jt(t,this.namespace);return typeof s>"u"?void 0:new Dt(new Yt(s,ue("disableProviderPing")))}}var WI=Object.defineProperty,BI=Object.defineProperties,GI=Object.getOwnPropertyDescriptors,Dh=Object.getOwnPropertySymbols,QI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,qh=(o,t,r)=>t in o?WI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Es=(o,t)=>{for(var r in t||(t={}))QI.call(t,r)&&qh(o,r,t[r]);if(Dh)for(var r of Dh(t))JI.call(t,r)&&qh(o,r,t[r]);return o},yo=(o,t)=>BI(o,GI(t));class Go{constructor(t){this.events=new Ao,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Cs(Ts({level:(t==null?void 0:t.logger)||$h})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Go(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Es({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,As(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:ye("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=UI(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==El)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(hr(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await dI.init({logger:this.providerOpts.logger||$h,relayUrl:this.providerOpts.relayUrl||PI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>mi(r)))];go("client",this.client),go("events",this.events),go("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=DI(r,this.session),a=Pl(s),u=qI(this.namespaces,this.optionalNamespaces),l=yo(Es({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new LI({namespace:l});break;case"solana":this.rpcProviders[r]=new kI({namespace:l});break;case"cosmos":this.rpcProviders[r]=new zI({namespace:l});break;case"polkadot":this.rpcProviders[r]=new MI({namespace:l});break;case"cip34":this.rpcProviders[r]=new HI({namespace:l});break;case"elrond":this.rpcProviders[r]=new VI({namespace:l});break;case"multiversx":this.rpcProviders[r]=new KI({namespace:l});break;case"near":this.rpcProviders[r]=new FI({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&hr(a)&&this.events.emit("accountsChanged",a.map(jI))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,l=mi(a),g=fo(a)!==fo(u)?`${l}:${fo(u)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=yo(Es({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",yo(Es({},ye("USER_DISCONNECTED")),{data:t.topic}))}),this.on(qt.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(l=>mi(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=mi(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Ch}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Ch}/${t}`)}}const YI=Go,ZI="wc",XI="ethereum_provider",eP=`${ZI}@2:${XI}:`,tP="https://rpc.walletconnect.com/v1/",Co=["eth_sendTransaction","personal_sign"],rP=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],To=["chainChanged","accountsChanged"],iP=["chainChanged","accountsChanged","message","disconnect","connect"];var sP=Object.defineProperty,nP=Object.defineProperties,oP=Object.getOwnPropertyDescriptors,jh=Object.getOwnPropertySymbols,aP=Object.prototype.hasOwnProperty,cP=Object.prototype.propertyIsEnumerable,Uh=(o,t,r)=>t in o?sP(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,_i=(o,t)=>{for(var r in t||(t={}))aP.call(t,r)&&Uh(o,r,t[r]);if(jh)for(var r of jh(t))cP.call(t,r)&&Uh(o,r,t[r]);return o},Mh=(o,t)=>nP(o,oP(t));function Ns(o){return Number(o[0].split(":")[1])}function vo(o){return`0x${o.toString(16)}`}function uP(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:l,rpcMap:g}=o;if(!mo(t))throw new Error("Invalid chains");const w={chains:t,methods:s||Co,events:u||To,rpcMap:_i({},t.length?{[Ns(t)]:g[Ns(t)]}:{})},b=u==null?void 0:u.filter(j=>!To.includes(j)),N=s==null?void 0:s.filter(j=>!Co.includes(j));if(!r&&!l&&!a&&!(b!=null&&b.length)&&!(N!=null&&N.length))return{required:t.length?w:void 0};const S=(b==null?void 0:b.length)&&(N==null?void 0:N.length)||!r,R={chains:[...new Set(S?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:rP))],events:[...new Set(w.events.concat(l!=null&&l.length?l:iP))],rpcMap:g};return{required:t.length?w:void 0,optional:r.length?R:void 0}}class Qo{constructor(){this.events=new gt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=eP,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Qo;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=uP(this.rpc);try{const a=await new Promise(async(l,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Mh(_i({namespaces:_i({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(b=>{l(b)}).catch(b=>{g(new Error(b.message))})});if(!a)return;const u=Fw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:vo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",vo(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Mh(_i({},Bw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",vo(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],l=a.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(t==null?void 0:t.methods)||Co:[],w=a.length?(t==null?void 0:t.events)||To:[],b=(t==null?void 0:t.optionalMethods)||[],N=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(j=>this.formatChainId(j)),optionalChains:u.map(j=>this.formatChainId(j)),methods:g,events:w,optionalMethods:b,optionalEvents:N,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ns(this.rpc.chains):Ns(this.rpc.optionalChains),this.signer=await YI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Ew(()=>import("./index-Ci7BRqEw.js").then(a=>a.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(_i({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&mo(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&mo(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${tP}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const OP=Qo;export{OP as EthereumProvider,iP as OPTIONAL_EVENTS,rP as OPTIONAL_METHODS,To as REQUIRED_EVENTS,Co as REQUIRED_METHODS,Qo as default};
